function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}(this.webpackJsonp=this.webpackJsonp||[]).push([[4],{CkJa:function CkJa(e,t){},O9iK:function O9iK(e,t){},PpGX:function PpGX(e,t){e.exports={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chat"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isDisabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isRead"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"chatType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"members"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"objectId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"givenName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"botMembers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]};},zqWZ:function zqWZ(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"DataSource",function(){return Wt;});var i,a=n("+7/b"),s=n("svWY"),o=n("PpGX");!function(e){e[e.Value=0]="Value",e[e.Error=1]="Error";}(i||(i={}));var c=n("W1yN"),u=function(){function e(e,t,n){if(void 0===e&&(e=100),this.newScenario=t,e<0)throw new TypeError("BufferLimit has to be > 0");this._isComplete=!1,this._values=[],this._promiseResolutionFunctions=[],this._bufferLimit=e,this._overflowScenario=null,this._droppedEvents=0,this._operationName=n;}return e.prototype.next=function(e){this._push({type:i.Value,value:e});},e.prototype.error=function(e){this._push({type:i.Error,error:e});},e.prototype.complete=function(){for(this._isComplete=!0;this._promiseResolutionFunctions.length>0;){this._promiseResolutionFunctions.shift().resolve({done:!0});}},e.prototype.nextPromise=function(){var e=this;if(this._overflowScenario&&this._values.length<this._bufferLimit&&(this._overflowScenario.stop({size:this._droppedEvents}),this._overflowScenario=null,this._droppedEvents=0),this._values.length>0){var t=this._values.shift(),n=t.type,r=t.value,a=t.error;return n===i.Error?Promise.reject(a):Promise.resolve({done:!1,value:r});}return this._isComplete?Promise.resolve({done:!0}):new Promise(function(t,n){e._promiseResolutionFunctions.push({resolve:t,reject:n});});},e.prototype._push=function(e){if(this._promiseResolutionFunctions.length>0){var t=this._promiseResolutionFunctions.shift(),n=t.resolve,r=t.reject;e.type===i.Error?r(e.error):n({done:!1,value:e.value});}else{if(this._values.length>this._bufferLimit-1)throw this._droppedEvents+=1,!this._overflowScenario&&this.newScenario&&(this._overflowScenario=this.newScenario(c.a.OnAsyncIterableObserverOverflow),this._overflowScenario.appendEventData({operationName:this._operationName})),new Error("AsyncIterableObserver buffer is full, all future events will be dropped");this._values.push(e);}},e;}();function l(e,t,n,r){return Object(a.__asyncGenerator)(this,arguments,function(){var i,s,o;return Object(a.__generator)(this,function(c){switch(c.label){case 0:i=new u(t,n,r),s=e.subscribe(i),c.label=1;case 1:return c.trys.push([1,,8,9]),[4,Object(a.__await)(i.nextPromise())];case 2:o=c.sent(),c.label=3;case 3:return!o||o.done?[3,7]:[4,Object(a.__await)(o.value)];case 4:return[4,c.sent()];case 5:return c.sent(),[4,Object(a.__await)(i.nextPromise())];case 6:return o=c.sent(),[3,3];case 7:return[3,9];case 8:return s.unsubscribe(),[7];case 9:return[2];}});});}var d=n("zQSw"),p=n("3J71"),m=n("CVLn"),g=(n("s7wg"),n("IoEE")),h=n("z4q9"),v=n("e4hD"),f=n("YZyc"),b=n("g5XK");var y,_,O=function O(e){return!!e&&(Object(s.endsWith)(e,v.u)||Object(s.startsWith)(e,v.v));},j=function j(e){return!(!e.properties||!e.properties[v.d.Alerts])&&"true"!==e.properties[v.d.Alerts].toLowerCase();},S=n("FaER"),C=n("vJjW"),w=n("ifNO"),I=function I(e){return"incoming"===e?g.a.CallDirection.Incoming:"outgoing"===e?g.a.CallDirection.Outgoing:g.a.CallDirection.Unknown;},M=function M(e){switch(e){case"missed":return g.a.CallLogCallState.Missed;case"accepted":return g.a.CallLogCallState.Accepted;case"declined":return g.a.CallLogCallState.Declined;case"acceptedElsewhere":return g.a.CallLogCallState.AcceptedElsewhere;default:return g.a.CallLogCallState.Unknown;}},T=function T(e){return"twoParty"===e?g.a.CallLogCallType.TwoParty:"multiParty"===e?g.a.CallLogCallType.MultiParty:g.a.CallLogCallType.Unknown;},k=function k(e){switch(e){case"default":return g.a.CallLogSessionType.Default;case"screenSharing":case"ScreenSharing":return g.a.CallLogSessionType.ScreenSharing;case"emergencyGroupCall":return g.a.CallLogSessionType.EmergencyGroupCall;default:return g.a.CallLogSessionType.Unknown;}},E=function E(e){return Object(a.__assign)({type:"default"},e);},L=function L(e){return{type:e.type,onBehalfOf:e.onBehalfOf&&Object(a.__assign)({type:"default"},e.onBehalfOf),details:e.details&&Object(a.__assign)({type:"default"},e.details)};},D=function D(e,t){if(e)try{var n=JSON.parse(e),r=n.applicationContent,i=n.callDirection,a=n.callId,s=n.callState,o=n.callType,c=n.connectTime,u=n.endTime,l=n.messageId,d=n.originatorParticipant,p=n.participantList,m=n.sessionType,g=n.sharedCorrelationId,h=n.startTime,v=n.targetParticipant,f=n.threadId;return{applicationContent:r&&L(r),callDirection:I(i),callId:a,callState:M(s),callType:T(o),connectTime:c,endTime:u,messageId:l,originatorParticipant:d&&E(d),participantList:p?p.map(E):[],startTime:h,targetParticipant:v&&E(v),threadId:f,sessionType:k(m),sharedCorrelationId:null!=g?g:""};}catch(e){t.newLogger("Call History Helper").log("UnhandledException in message transformation: "+e);}};!function(e){e[e.Standard=0]="Standard",e[e.Important=2]="Important",e[e.Urgent=3]="Urgent";}(y||(y={})),function(e){e.Standard="",e.Important="high",e.Urgent="urgent";}(_||(_={}));var U=function U(e){return N(e)===g.a.MessageImportance.Important;},P=function P(e){return _[e]||_.Standard;},N=function N(e){switch(e){case _.Important:case y.Important:return g.a.MessageImportance.Important;case _.Urgent:case y.Urgent:return g.a.MessageImportance.Urgent;case _.Standard:case y.Standard:default:return g.a.MessageImportance.Standard;}},A=n("lMlv"),R="BOT";var B,x=function x(e){var t=e.mri,n=e.objectId,r={__typename:"User",id:t||n,objectId:n,mri:t,displayName:e.displayName,givenName:e.givenName,surname:e.surname,type:e.type,jobTitle:e.jobTitle,userPrincipalName:e.userPrincipalName,email:e.email,tenantId:e.tenantId,sipProxyAddress:e.sipProxyAddress,mobile:e.mobile,telephoneNumber:e.telephoneNumber};if(r=H(e,r),e.featureSettings&&(r=Object(a.__assign)(Object(a.__assign)({},r),{featureSettings:e.featureSettings})),r=F(e,r),r=z(e,r),function(e){var t=e;return void 0!==t.isFederated||void 0!==t.isAnonymousB2bUser;}(e)){var i=e.isFederated,s=e.fetchErrorCode,o=e.isAnonymousB2bUser;r=Object(a.__assign)(Object(a.__assign)({},r),{isFederated:i,fetchErrorCode:s,isAnonymousB2bUser:o});}return q(r);},F=function F(e,t){return e.isBlocked&&(t=Object(a.__assign)(Object(a.__assign)({},t),{isBlocked:e.isBlocked})),e.cid&&(t=Object(a.__assign)(Object(a.__assign)({},t),{cid:e.cid})),e.phonesInfo&&(t=Object(a.__assign)(Object(a.__assign)({},t),{phonesInfo:e.phonesInfo})),e.emailsInfo&&(t=Object(a.__assign)(Object(a.__assign)({},t),{emailsInfo:e.emailsInfo})),t;},z=function z(e,t){return(function(e){return void 0!==e.userType;}(e)||function(e){var t=e;return t.type?t.type===R:Object(h.e)(e.mri);}(e))&&(t=Object(a.__assign)(Object(a.__assign)({},t),{userType:e.userType,description:e.description,isUnified:e.isUnified,securityEnabled:e.securityEnabled,featureSettings:e.featureSettings,imageUri:e.imageUri,userLocation:e.userLocation})),t;},H=function H(e,t){var n=e.phones;return n&&(t=Object(a.__assign)(Object(a.__assign)({},t),{phones:n.map(function(e){return K(e);})})),t;},K=function K(e){return{number:e.number,type:e.type};},q=function q(e){var t=e.mri;if(function(e){return e&&e.startsWith(A.a.Pstn);}(t)&&!e.displayName){var n=function(e){var t=e.slice(A.a.Pstn.length),n=t.indexOf("_");return-1!==n&&(t=t.slice(0,n)),t;}(t);return Object(a.__assign)(Object(a.__assign)({},e),{displayName:n,givenName:n});}return e.displayName?e:Object(a.__assign)(Object(a.__assign)({},e),{displayName:"Unknown User"});},G=S.a,W=new Map([["sms",g.a.EscalationModality.SMS],["email",g.a.EscalationModality.Email],["call",g.a.EscalationModality.Call],["teamscall",g.a.EscalationModality.TeamsCall],["etnp",g.a.EscalationModality.ETNP]]),V=new Set(["RichText/Media_CallRecording","Event/Call"]);!function(e){e.Add="Add",e.Remove="Remove";}(B||(B={}));var J=function J(e){return e&&e.emotions?e.emotions.map(function(e){return{key:e.key,users:e.users.map(function(e){var t=e.mri,n=e.time,r=e.value;return{id:G(t),time:n,value:r};})};}):null;},Q=function Q(e){if(!e||!e.emotions)return null;var t=e.emotions;return Object.keys(t).map(function(e){return{key:e,count:t[e]};});},X=function X(e){return e&&e.escalations?JSON.parse(e.escalations).map(function(e){var t=e.key,n=e.users;return{key:W.get(t),users:n.map(function(e){var t=e.mri,n=e.time,r=e.value;return{mri:G(t),time:n,value:r};})};}):null;},Y=function Y(e,t){return e&&e.mentions?$(e.mentions,t):null;},Z=function Z(e,t){return e&&e.onbehalfof?$(e.onbehalfof,t):null;},$=function $(e,t){var n="string"==typeof e?JSON.parse(e):e;return n?n.map(function(e){var n=e.itemid,r=e.mri,i=e.displayName,a=e.mentionType;return{id:t+"_"+n,userId:r,itemId:n,displayName:i,mentionType:a};}):null;},ee=function ee(e){if(!e||!e.files)return null;try{var t=JSON.parse(null==e?void 0:e.files);return(t=t.filter(function(e){return"deeplink"===e.type;})).map(function(e){var t=e.id,n=e.title,r=e.fileInfo,i=e.channelId;return{id:t,title:n,state:e.state,serverRelativeUrl:r.serverRelativeUrl,channelId:i,siteUrl:r.siteUrl,objectUrl:r.fileUrl};});}catch(e){return null;}},te=function te(e){if(!e||!e.files)return null;try{var t=JSON.parse(e.files);return t=t.filter(function(e){return"deeplink"!==e.type;}),Object(s.map)(t,function(e){return ne(e);});}catch(e){return null;}},ne=function ne(e){var t=["http","https"],n=e.filePreview,r=e.chicletBreadcrumbs,i=e.fileInfo,s=e.anchorFileId,o=e.progressComplete,c=e.isUploadError,u=e.fileChicletState,l=i.shareUrl,d=i.shareId,p=i.itemId,m=n||{},h=null==u?void 0:u.serviceName,v=re(e,2),f=v.id,b=v.baseUrl,y=v.objectUrl,_=v.type,O=v.title,j=v.state,S="active"!==j&&"hidden"!==j;return Object(a.__assign)({id:f,itemId:p,chicletBreadcrumbs:r,baseUrl:Object(C.b)(b,t),objectUrl:Object(C.b)(y,t),shareId:d,shareUrl:l,type:_,title:O,fileId:f,isReferencedFile:S,anchorFileId:s,progressComplete:o&&parseInt(o,10)||null,serviceName:h&&g.a.FileViewServiceName[h],state:j&&g.a.FileChicletState[j],hasUploadFailed:c},m);},re=function re(e,t){var n,r,i=e.version,a=e.id,s=e.baseUrl,o=e.objectUrl,c=e.type,u=e.title,l=e.state;if(i!==t&&(a=e.itemid,u=e.fileName,c=e.fileType,o=(n=e.fileInfo).fileUrl,s=n.siteUrl,l=null===(r=e.fileChicletState)||void 0===r?void 0:r.state),"string"!=typeof a)throw Object(w.a)("ChatHelpers",p.c.Undefined,"toFiles",{id:a,version:i,type:c},"File id is missing");return{id:a,baseUrl:s,objectUrl:o,type:c,title:u,state:l};},ie=function ie(e){return JSON.stringify(Object(s.map)(e,function(e){var t=e.id,n=e.itemId,r=e.baseUrl,i=e.type,a=e.title,s=e.objectUrl,o=e.previewUrl,c=e.shareUrl,u=e.shareId,l=e.state,d=e.chicletBreadcrumbs,p=e.serviceName,m=e.previewHeight,g=e.previewWidth,h=e.progressComplete;return{itemid:t,fileName:a,fileType:i,fileInfo:{itemId:n,fileUrl:s,siteUrl:r,serverRelativeUrl:"",shareUrl:c,shareId:u},fileChicletState:{serviceName:p,state:l},"@type":"http://schema.skype.com/File",version:2,id:t,baseUrl:r,objectUrl:s,type:i,title:a,state:l,chicletBreadcrumbs:d,providerData:{code:null,type:0},botFileProperties:{},isUploadError:e.hasUploadFailed,progressComplete:h,filePreview:{previewUrl:o,previewHeight:m,previewWidth:g}};}));},ae=function ae(e){return e&&JSON.stringify(Object(s.map)(e,function(e){var t=e.content,n=Object(a.__rest)(e,["content"]);return Object(a.__assign)(Object(a.__assign)({},n),{content:JSON.parse(t)});}));},se=function se(e,t){if(!e||!e.links)return{urlPreview:null,embeddedLinks:null};try{var n=["http","https"],r=JSON.parse(e.links),i=[],a=[];return r.forEach(function(e){oe(e,i,n),ce(e,a,n);}),{urlPreview:a.length>0?a[0]:null,embeddedLinks:i};}catch(e){return t.newLogger("Chat Helper").log("UnhandledException in message transformation: "+e),{urlPreview:null,embeddedLinks:null};}},oe=function oe(e,t,n){var r=e.url,i=e.fileShareUrlMeta,a=e.title,s=e.description,o=Object(C.b)(r,n);i&&t.push({objectUrl:o,title:a,description:s,fileShareUrlMeta:i});},ce=function ce(e,t,n){var r=e.url,i=e.preview,a=e.previewenabled,s=i||{},o=s.previewurl,c=s.previewmeta,u=s.title,l=s.description,d=Object(C.b)(r,n);t.push({url:d,thumbnail:Object(C.b)(o,n),title:u,description:l,previewEnabled:a,thumbnailMeta:c?{width:c.width,height:c.height}:null});},ue=function ue(e,t){if(!t||!t.cards)return null;try{return JSON.parse(t.cards).map(function(e){var t=e.appIcon,n=e.appId,r=e.appName,i=e.cardClientId,a=e.content,s=e.contentType,o=e.locale;return{appIcon:t,appId:n,appName:r,cardClientId:i,content:JSON.stringify(a),contentType:s,locale:o};});}catch(t){return e.newLogger("Chat Helper").log("UnhandledException in toCards: "+t),null;}},le=function le(e,t,n,r){var i=r&&r.policyViolation,a=r&&r.genericStreamMetadata;if(!i&&!a)return null;var s={};if("string"==typeof i)try{i=JSON.parse(i);}catch(n){e.newLogger("Chat Helper").log("Exception in parsing PolicyViolation in message: "+t+". Error: "+n);}i&&(s.policyViolation=i);var o=a&&a.policyTip;if("string"==typeof a)try{o=JSON.parse(a).policyTip;}catch(n){e.newLogger("Chat Helper").log("Exception in parsing policy tip in message: "+t+". Error: "+n);}return o&&(s.dlpData={id:t,content:n,policyTip:o}),s;},de=function de(e,t){if(!t||!t.meeting)return null;try{var n=JSON.parse(t.meeting);return{organizerId:n.organizerId,tenantId:n.tenantId,itemId:n.itemid,meetingTitle:n.meetingtitle,scheduledMeetingInfo:n.scheduledmeetinginfo};}catch(t){return e.newLogger("Chat Helper").log("UnhandledException in toMeeting: "+t),null;}},pe=function pe(e,t,n,r){var i=t||n;if(i)return i;if(r&&V.has(e)){var a=r.match(/<id type="callId"[^>]*?\svalue="([^"]+?)"/i);return a&&a[1]||null;}return null;},me=function me(e,t){return t&&t.body&&t.version===e&&t.sourceLanguageCode?{status:t.toggled&&t.body?g.a.TranslationStatusV2.Done:g.a.TranslationStatusV2.NotStarted,content:t.body,sourceLangCode:t.sourceLanguageCode,version:t.version}:{status:g.a.TranslationStatusV2.NotStarted,content:void 0,sourceLangCode:void 0,version:void 0};},ge=function ge(e,t){return"-1"===e?t:e;},he=function he(e,t,n){var r=e.id,i=e.content,s=e.originalarrivaltime,o=e.imdisplayname,c=e.from,u=e.messagetype,l=e.properties,d=e.skypeguid,p=e.callId,m=e.clientmessageid,h=e.translation,v=e.version,f=e.annotationsSummary,b=e.userHasStarred;return r&&Object(a.__assign)(Object(a.__assign)({__typename:"Message",id:ge(r,m),content:i,originalArrivalTime:s,imDisplayName:o,from:G(c),messageType:Oe(t,u,l),isImportant:U(l&&l.importance),importance:N(l&&l.importance),interopDeliveryState:l&&l.deliveryState&&l.deliveryState.state,smsDeliveryReports:l&&l.smsDeliveryReports?l.smsDeliveryReports:null,emotions:J(l),emotionsSummary:Q(f),announcement:ye(l),escalations:X(l),mentions:Y(l,r),onBehalfOf:Z(l,r),cards:ue(t,l),files:te(l),deeplinks:ee(l)},se(l,t)),{deleteTime:l&&l.deletetime,editTime:l&&l.edittime,status:n||g.a.MessageStatus.Delivered,dlpContext:le(t,r,i,l),meeting:de(t,l),notification:$e(t,l),callId:pe(u,p,d||l&&l.skypeguid,i),translationV2:me(v,h),clientMessageId:m,version:v,callLog:l&&D(l["call-log"],t),userHasSaved:b})||void 0;};function ve(e,t,n){void 0===t&&(t=""),void 0===n&&(n=[]);var r=new Date();return{__typename:"Conversation",id:e,title:t,members:n,isDisabled:!1,isOneOnOne:!1,isRead:!0,chatType:g.a.ChatType.Chat,type:g.a.ChatType.Chat,lastMessage:{__typename:"Message",content:"",messageType:"Text",id:null,originalArrivalTime:r.toISOString(),imDisplayName:null,from:null,deleteTime:null,files:null,cards:null},consumptionHorizon:{__typename:"ConsumptionHorizon",id:e,originalArrivalTime:r.toISOString(),timeStamp:null,clientMessageId:null}};}var fe=function fe(e,t){var n=e.annotationsSummary,r=e.id,i=e.from,o=e.messageType,c=e.properties,u=e.version,l=Object(a.__rest)(e,["annotationsSummary","id","from","messageType","properties","version"]);if(!r)return null;try{return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({__typename:"Message",id:r,from:i,messageType:Oe(t,o,c),version:Object(s.isNumber)(u)?u.toString():void 0,isImportant:U(c&&c.importance),importance:N(c&&c.importance),interopDeliveryState:c&&c.deliveryState&&c.deliveryState.state,smsDeliveryReports:(null==c?void 0:c.smsDeliveryReports)||null,emotions:J(c),emotionsSummary:Q(n),announcement:ye(c),escalations:X(c),mentions:Y(c,r),onBehalfOf:Z(c,r),cards:ue(t,c),files:te(c),deeplinks:ee(c)},se(c,t)),{deleteTime:c&&c.deletetime,editTime:c&&c.edittime,status:g.a.MessageStatus.Delivered,dlpContext:le(t,r,l.content,c),meeting:de(t,c),callId:c&&c.skypeguid,translationV2:void 0,callLog:c&&D(c["call-log"],t)}),l);}catch(e){return t.newLogger("Chat Helper").log("UnhandledException in message transformation: "+e),Object(a.__assign)({id:r,from:i,messageType:Oe(t,o,c),isImportant:null,emotions:null,mentions:null,files:null,announcement:null,urlPreview:null,deleteTime:null,status:null},l);}},be=function be(e){var t=e.originalArrivalTime,n=e.timeStamp,r=e.clientMessageId;return{originalArrivalTime:new Date(t).toISOString(),timeStamp:new Date(n).toISOString(),clientMessageId:r};},ye=function ye(e){var t={title:"",originalImageUrl:null,croppedImageUrl:null,colorTheme:null};if(!e)return t;var n="string"==typeof e.cards?JSON.parse(e.cards):e.cards;if(!n||0===n.length)return t;var r=n.find(function(e){return"application/vnd.microsoft.teams.messaging-announcementBanner"===e.contentType;});if(!r)return t;var i=_e(r);return{title:e.title?e.title:"",originalImageUrl:i.originalImageUrl,croppedImageUrl:i.croppedImageUrl,colorTheme:i.colorTheme};},_e=function _e(e){var t=Object(s.get)(e,"content.imageData.origImage.src",null),n=Object(s.get)(e,"content.imageData.croppedImage.src",null),r=Object(s.get)(e,"content.imageData.colorTheme",null)||Object(s.get)(e,"content.colorTheme",null);return{originalImageUrl:t=void 0===t?null:t,croppedImageUrl:n=void 0===n?null:n,colorTheme:r=void 0===r?null:r};},Oe=function Oe(e,t,n){return t===v.l.HTML&&je(e,n)?v.l.Collaborate:t;},je=function je(e,t){var n=ue(e,t);if(!n)return!1;var r=Object(s.find)(n,function(e){return"application/vnd.microsoft.card.fluid"===e.contentType;});return!!r&&!!JSON.parse(r.content).componentUrl;},Se=function Se(e,t){if(Object(s.isEmpty)(t))return null;var n=t.split(";"),r=n[0],i=n[1],o=n[2];return Object(a.__assign)({id:e},be({originalArrivalTime:parseInt(r,10),timeStamp:parseInt(i,10),clientMessageId:o}));},Ce=function Ce(e,t,n){var r=t&&t[v.d.SmartReplies];return r&&"string"==typeof r?we(e,r,n):null;},we=function we(e,t,n){try{var r=JSON.parse(t);return Ie(e,r);}catch(e){return n.newLogger("Chat Helper").log("Exception in parsing quick reply augmentation. Error: "+e),null;}},Ie=function Ie(e,t){var n=t&&t.suggestedActivities&&t.suggestedActivities.find(function(e){return"suggestion"===e.type&&e.from&&e.from.id===v.A;});if(!(n&&n.replyToId&&n.timestamp&&n.suggestedActions.actions))return null;var r=n.suggestedActions.actions.map(function(e){return{channelDataId:e.channelData&&e.channelData.id,timestamp:e.channelData&&e.channelData.utcTime,value:e.value};}).filter(function(e){return e.channelDataId&&e.timestamp&&e.value;});return r&&0!==r.length?{convId:e,timestamp:n.timestamp,replyMessageId:n.replyToId,suggestions:r}:null;},Me=function Me(e){switch(e){case f.k.None:return g.a.MeetingType.Unknown;case f.k.Adhoc:return g.a.MeetingType.Adhoc;case f.k.Scheduled:return g.a.MeetingType.Scheduled;case f.k.Recurring:return g.a.MeetingType.Recurring;case f.k.Broadcast:return g.a.MeetingType.Broadcast;}},Te=function Te(e){return e&&e.map(function(e){return{id:e.id,originalArrivalTime:e.consumptionhorizon,messageVisibilityTime:e.messageVisibilityTime};})||null;};var ke=function ke(e,t,n,r){try{var i=e.members;return function(e,t,n,r){var i=e.id,s=e.lastMessage,o=e.properties,c=e.threadProperties,u=Se(i,o[v.d.ConsumptionHorizonBookmark]);return Object(a.__assign)(Object(a.__assign)({},e),{id:i,chatSubType:Pe(c.threadType),chatType:Ae(c.threadType),consumptionHorizon:Se(i,o[v.d.ConsumptionHorizon]),consumptionHorizonBookmark:u,smartReplySuggestions:Ce(i,o,n),creator:c[v.C.Creator],isUserMember:ze(t,r),isDisabled:Fe(c.isDisabled),isLastMessageFromMe:c.isLastMessageFromMe,isMuted:j(e),isOneOnOne:xe(c[v.C.P2PChatUniqueRosterThread]),isRead:c.isRead,lastMessage:s&&he(s,n),meetingInformation:He(i,c[v.C.Meeting]),members:t,tenantId:c[v.C.TenantId],title:c.topic,type:null,userConsumptionHorizon:u,interopConversationStatus:Be(o[v.d.InteropConversationStatus])});}(e,i&&i.length?i.map(function(e){return e.id in t?t[e.id]:function(e){return x(Object(a.__assign)(Object(a.__assign)({},e),{mri:e.id,objectId:"",type:"",userPrincipalName:"",isMuted:e.isReader}));}(e);}):[],n,r);}catch(t){return n.newLogger("Chat Helper").log("UnhandledException in toConversationSchemaFromSkypeConversationLocal transformation: "+t),Object(a.__assign)(Object(a.__assign)({},e),{id:e.id,isUserMember:!1,members:[],type:null});}},Ee=function Ee(e,t,n){var r=e.id,i=e.members,o=e.consumptionHorizon,c=e.userConsumptionHorizon,u=e.lastMessage,l=e.creator,d=e.meetingInformation,p=e.isDisabled,m=e.isMuted,h=e.isLastMessageFromMe,v=e.isRead,f=e.isOneOnOne,b=e.chatType,y=(e.createdAt,e.interopConversationStatus),_=e.quickReplyAugmentation,O=Object(a.__rest)(e,["id","members","consumptionHorizon","userConsumptionHorizon","lastMessage","creator","meetingInformation","isDisabled","isMuted","isLastMessageFromMe","isRead","isOneOnOne","chatType","createdAt","interopConversationStatus","quickReplyAugmentation"]);try{var j=Object(s.map)(i,x),S=d&&{id:r,subject:d.subject,startTime:d.startTime,scenario:d.scenario,endTime:d.endTime,meetingType:d.meetingType?Me(d.meetingType):g.a.MeetingType.Unknown};return Object(a.__assign)(Object(a.__assign)({__typename:"Conversation"},O),{id:r,consumptionHorizon:o&&Object(a.__assign)({__typename:"ConsumptionHorizon",id:r},be(o)),consumptionHorizonBookmark:c&&Object(a.__assign)({__typename:"ConsumptionHorizonBookmark",id:r},be(c)),userConsumptionHorizon:c&&Object(a.__assign)({__typename:"ConsumptionHorizonBookmark",id:r},be(c)),lastMessage:u&&fe(u,t),members:j,creator:l,meetingInformation:S,isDisabled:!!p,isMuted:m,isUserMember:ze(j,n),isLastMessageFromMe:!!h,isRead:v,isOneOnOne:!!f,chatType:Ae(b),interopConversationStatus:Be(y),smartReplySuggestions:_&&Ie(r,_)});}catch(e){return t.newLogger("Chat Helper").log("UnhandledException in conversation object transformation: "+e),Object(a.__assign)(Object(a.__assign)({},O),{id:r,isUserMember:!1,consumptionHorizon:null,consumptionHorizonBookmark:null,userConsumptionHorizon:null,lastMessage:null,members:[],creator:null,meetingInformation:null,chatType:null});}},Le=function Le(e){var t=e.notificationCount,n=e.chatCount;return{notificationCount:t,chatCount:n.teamsChats+n.sfbGatewayChats+n.federatedChats};};function De(e){return JSON.stringify(Object(s.map)(e,function(e){var t=e.mentionType,n=e.displayName;return{"@type":"http://schema.skype.com/Mention",itemid:e.itemId,mri:e.userId,mentionType:t,displayName:n};}));}var Ue,Pe=function Pe(e){if(e)return"space"===e||"topic"===e?f.d.Channel:"meeting"===e?f.d.Meeting:f.d.None;},Ne=new Map([["chat",g.a.ChatType.Chat],["phonechat",g.a.ChatType.PhoneChat],["meeting",g.a.ChatType.Meeting],["sfbinteropchat",g.a.ChatType.SfBInteropChat]]),Ae=function Ae(e){var t=null;return null==e||void 0===(t=Ne.get(e))&&(t=null),t;},Re=new Map([["AcceptPending",g.a.InteropConversationStatus.AcceptPending],["Accepted",g.a.InteropConversationStatus.Accepted],["Blocked",g.a.InteropConversationStatus.Blocked]]),Be=function Be(e){return e&&Re.get(e)||null;},xe=function xe(e){switch(_typeof(e)){case"string":e="true"===e.toLowerCase();case"boolean":return e;default:return!1;}},Fe=function Fe(e){return Object(s.isString)(e)?"true"===e.toLowerCase():e||!1;},ze=function ze(e,t){return!(!(null==t?void 0:t.id)||!e)&&e.some(function(e){return e.id===t.id;});},He=function He(e,t){if(t){var n=JSON.parse(t);if(Object.keys(t).length)return Object(a.__assign)(Object(a.__assign)({id:e},n),{meetingType:n.meetingType?Me(f.k[n.meetingType]):g.a.MeetingType.Unknown});}},Ke=function Ke(e,t,n){var r=J(n.properties);return!!r&&r.some(function(n){return n.key===e&&!!n.users&&n.users.some(function(e){return e.id===t;});});},qe=function qe(e,t){if(e&&e.messagetype===v.c.MemberConsumptionHorizonUpdate){var n=e.conversationid||Object(S.a)(e.conversationLink),r=JSON.parse(e.content);return{__typename:"ConsumptionHorizonUpdate",convId:n,memberConsumptionHorizon:{id:r.user,originalArrivalTime:r.consumptionhorizon,messageVisibilityTime:r.messageVisibilityTime}};}return Object(a.__assign)({__typename:"NewMessage"},function(e,t){var n=he(e,t);if(!n)throw Object(w.a)("ChatHelpers",p.c.Undefined,"toNewMessageSchema",{resource:e},"Bad shaped NewMessage");var r=null;if(e&&e.conversationLink){var i=Object(h.d)(e);r=i===n.id?null:i;}return{convId:e.conversationid||Object(h.c)(e),replyChainId:r,threadType:e.threadtype,threadTopic:e.threadtopic,message:n};}(e,t));},Ge=function Ge(e,t,n){return Object(a.__awaiter)(void 0,void 0,Promise,function(){var r,i,s,o,c,u;return Object(a.__generator)(this,function(l){switch(l.label){case 0:return r=e.id||"",i=e.properties,s=Object(h.a)(e.members,i,[]).members,o=He(r,i&&i.meeting),s?[4,t(s)]:[3,2];case 1:return u=l.sent(),[3,3];case 2:u=[],l.label=3;case 3:return c=u,[2,{__typename:"ThreadUpdate",conversation:Object(a.__assign)(Object(a.__assign)({id:r,title:i&&i.topic,isOneOnOne:i&&xe(i.uniquerosterthread),isUserMember:ze(c,n),members:c},o&&{meetingInformation:Object(a.__assign)({id:r},o)}),{chatType:i&&Ae(i.threadType)})}];}});});},We=function We(e){return e&&e.historyHiddenTime||null;},Ve=function Ve(e){return!!e&&!!e[v.d.Alerts]&&"true"!==e[v.d.Alerts].trim().toLowerCase();},Je=function Je(e,t,n,r){var i=e.resourceType,s=e.resource;return Object(a.__awaiter)(void 0,void 0,Promise,function(){var e,o,c;return Object(a.__generator)(this,function(a){switch(a.label){case 0:switch(a.trys.push([0,10,,11]),i){case"NewMessage":return[3,1];case"MessageUpdate":return[3,2];case"ThreadUpdate":return[3,3];case"ConversationUpdate":return[3,5];case"ResolveConversationLie":return[3,6];case"DiscardConversation":return[3,7];}return[3,8];case 1:return e=qe(s,n),[3,9];case 2:return e=function(e,t){var n;return{__typename:"MessageUpdate",message:he(e,t),threadType:null===(n=e.properties)||void 0===n?void 0:n.threadType};}(s,n),[3,9];case 3:return[4,Ge(s,t,r)];case 4:return e=a.sent(),[3,9];case 5:return e=function(e,t){var n=e.properties,r=e.threadProperties,i=e.lastMessage,a=e.isRetentionHorizonSet,s=n&&n.consumptionhorizon||null,o=n&&(n.userConsumptionHorizon||n.consumptionHorizonBookmark)||null,c=e.id||"",u=Se(c,o);return{__typename:"ConversationUpdate",conversation:{id:c,isUserMember:!1,isDisabled:Fe(r&&r.isDisabled),title:r&&r.topic,consumptionHorizon:Se(c,s),consumptionHorizonBookmark:u,userConsumptionHorizon:u,smartReplySuggestions:Ce(c,n,t),chatType:r&&Ae(r.threadType),chatSubType:r&&Pe(r.threadType),lastMessage:he(i,t),members:[],interopConversationStatus:n&&Be(n.interopconversationstatus)||null,isRetentionHorizonSet:a,isMuted:Ve(n),chatHistoryHiddenTime:We(n)}};}(s,n),[3,9];case 6:return e={__typename:i,lieConvId:(o=s).id,realConvId:o.realConvId},[3,9];case 7:return e={__typename:i,convId:(o=s).id},[3,9];case 8:return[3,9];case 9:return[3,11];case 10:return c=a.sent(),n.newLogger("ChatHelpers").warn("Error processing chat service event: "+c),[3,11];case 11:return[2,e];}});});};!function(e){e.SfBGatewayChat="@sfb.unq.gbl.spaces",e.OnPremFederatedGatewayChat="@sfbonprem.unq.gbl.spaces",e.FederatedGatewayChat="@fed.unq.gbl.spaces";}(Ue||(Ue={}));var Qe=function Qe(e){return!!e&&e.endsWith(Ue.SfBGatewayChat);},Xe=function Xe(e){return!!e&&(e.includes(":fed:preview")||e.endsWith(Ue.FederatedGatewayChat)||e.endsWith(Ue.OnPremFederatedGatewayChat));},Ye=function Ye(e,t){return Object(s.filter)(e,Object(s.omit)(t,"__typename"));},Ze=function Ze(e){return!!e&&-1!==e.indexOf("preview-");},$e=function $e(e,t){if(!t||!t.notification)return null;try{var n=t.notification;return{alertInMeeting:n.alertInMeeting,externalResourceUrl:n.externalResourceUrl};}catch(t){return e.newLogger("Chat Helper").log("UnhandledException in chat message notification transformation: "+t),null;}},et=n("VxlM"),tt=n("CdiN"),nt=n("f4tu"),rt=n("pybt"),it=n("8FIh"),at=n("cvjv"),st=n("PCsB"),ot=new nt.d(1e4);function ct(e,t,n){return Object(a.__asyncGenerator)(this,arguments,function(){var r;return Object(a.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,8,,10]),[4,Object(a.__await)(n())];case 1:return r=i.sent(),[4,Object(a.__await)(lt({chatService:e,chatServiceEndpointProvider:t,userId:r,delay:new nt.b(2e3,2,12e4)}))];case 2:return[4,a.__await.apply(void 0,[i.sent()])];case 3:return[4,i.sent()];case 4:return i.sent(),[4,Object(a.__await)(Object(rt.a)(12e4))];case 5:return i.sent(),[4,Object(a.__await)("")];case 6:return[4,i.sent()];case 7:return i.sent(),[3,10];case 8:return i.sent(),[4,Object(a.__await)(Object(rt.a)(ot.next()))];case 9:return i.sent(),[3,10];case 10:return[3,0];case 11:return[2];}});});}var ut,lt=Object(it.a)(function(e){var t=e.chatServiceEndpointProvider,n=e.userId;return Object(at.a)(t.postActiveEndpoint(n),3e4);},function(e,t){var n=t.delay;return Object(a.__awaiter)(void 0,void 0,void 0,function(){return Object(a.__generator)(this,function(t){if(e.context===p.d.RequireStatus&&Object(st.a)(Object(w.e)(e,"status",0))||e.context===p.d.Timed||e instanceof TypeError)throw e;return[2,Object(rt.a)(n.next())];});});}),dt=n("jN5E");function pt(e,t){function n(e){if(!Object(s.isArray)(e)&&!Object(s.isObject)(e)||Object(s.isDate)(e))return e;var n={};Object(s.forOwn)(e,function(e,r){n[r]=pt(e,t);});var r=n,i=t;r[i];return Object(a.__rest)(r,["symbol"==_typeof(i)?i:i+""]);}return Object(s.isArray)(e)?e.map(n):n(e);}!function(e){e.mention="http://schema.skype.com/Mention",e.inputExtension="http://schema.skype.com/InputExtension",e.amsVideo="http://schema.skype.com/AMSVideo",e.amsImage="http://schema.skype.com/AMSImage",e.emoji="http://schema.skype.com/Emoji",e.live="http://schema.skype.com/Live",e.giphy="http://schema.skype.com/Giphy",e.filesHyperlink="http://schema.skype.com/HyperLink/Files",e.hyperLink="http://schema.skype.com/HyperLink",e.reply="http://schema.skype.com/Reply",e.fluidLink="http://schema.skype.com/FluidLink";}(ut||(ut={}));function mt(e,t){return JSON.stringify(Object(a.__spreadArrays)(function(e){return Object(s.map)(Object(s.compact)(e),function(e,t){return{"@type":ut.hyperLink,itemid:t.toString(),url:e.url,previewenabled:e.previewEnabled,preview:{previewurl:e.thumbnail,previewmeta:e.thumbnailMeta,title:e.title,description:e.description}};});}(e),function(e){return e=pt(e,"__typename"),Object(s.map)(Object(s.compact)(e),function(e){return{"@type":ut.hyperLink,title:e.title,description:e.description,fileShareUrlMeta:e.fileShareUrlMeta,url:e.fileShareUrlMeta&&e.fileShareUrlMeta.shareUrl};});}(t)));}function gt(e,t){return Object(a.__awaiter)(this,void 0,Promise,function(){var n,r,i,o;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return n=Object(s.uniqBy)(e,function(e){return e.id;}),r=Object(s.chunk)(n.map(function(e){return e.id;}),t.MAX_PEOPLE_MRI_LIMIT),[4,Promise.all(r.map(function(e){return t.getPeopleProfilesByMris(e);}))];case 1:return i=a.sent(),o=[],i.forEach(function(e){o=o.concat(Array.from(e.values(),x));}),[2,o];}});});}var ht=function ht(e,t,n,r,i,s){return Object(a.__awaiter)(void 0,void 0,Promise,function(){return Object(a.__generator)(this,function(a){return[2,i?vt(e,i,n,r,s):ft(e,t,n,s)];});});};function vt(e,t,n,r,i){return Object(a.__awaiter)(this,void 0,Promise,function(){var s,o;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return[4,t.getConversation(e)];case 1:return(s=a.sent())?[4,bt([s],r)]:[2,{id:e,members:[]}];case 2:return o=a.sent(),[2,ke(s,o,n,i)];}});});}var ft=function ft(e,t,n,r){return Object(a.__awaiter)(void 0,void 0,Promise,function(){var i;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return[4,t.getChat(e)];case 1:return i=a.sent(),[2,Ee(i,n,r)];}});});},bt=function bt(e,t){return Object(a.__awaiter)(void 0,void 0,Promise,function(){var n,r,i;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return n=[],e.forEach(function(e){return e.members&&e.members.forEach(function(e){n.push(e);});}),[4,gt(n,t)];case 1:return r=a.sent(),i={},r.forEach(function(e){i[e.id]=e;}),[2,i];}});});},yt=function yt(e,t,n,r,i){return Object(a.__awaiter)(void 0,void 0,Promise,function(){var s,o,c,u,l,d,p,g;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return[4,n.getChat(e)];case 1:if(s=a.sent(),o=s&&s.members,c=s&&s.isOneOnOne,u=r.newLogger("Chat Resolvers"),l=new m.a(i),!(c||o&&o.length<=l.maxRosterSizeInGroupChatChatServiceLimit))return[3,6];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,t.getMembersConsumptionHorizon(e)];case 3:return d=a.sent(),[3,5];case 4:return p=a.sent(),u.error("fail to fetch consumption horizon data from server because: "+p),[3,5];case 5:return[3,7];case 6:u.log("chat "+e+" is not supported for read receipt."),a.label=7;case 7:return g=d&&d.consumptionhorizons,[2,Te(g)];}});});},_t=function _t(e){return e?e.map(function(e){return{id:e.id,title:e.title,channelId:e.channelId,siteUrl:e.siteUrl,serverRelativeUrl:e.serverRelativeUrl,objectUrl:e.objectUrl,state:e.state,__typename:"DeepLink"};}):null;},Ot=function Ot(e,t,n){return void 0===n&&(n=null),Object(a.__awaiter)(void 0,void 0,Promise,function(){var r,i,s;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return r=[],e.forEach(function(e){return r.push({id:e});}),i=2,[4,gt(r,t)];case 1:return s=a.sent(),[2,{__typename:"Conversation",id:v.m.SkypeSpacesThread+"preview-"+Object(dt.v4)(),title:n,members:s,botMembers:null,isDisabled:!1,isOneOnOne:e.length===i,isRead:!1,chatType:g.a.ChatType.Chat,type:g.a.ChatType.Chat}];}});});},jt=function jt(e,t,n,r){return void 0===r&&(r=""),Object(a.__awaiter)(void 0,void 0,Promise,function(){var i;return Object(a.__generator)(this,function(s){return i=t&&1===t.length?{uniquerosterthread:!0,fixedRoster:!0}:{},[2,e.createThread(n,r,Object(a.__assign)({threadType:"chat",chatFilesIndexId:2},i))];});});},St=function St(e,t){var n=e.content,r=e.messageType,i=e.clientMessageId,o=e.files,c=e.deeplinks,u=e.importance,l=e.computed;void 0===t&&(t={});var d,p=void 0===l?{}:l,m=p.mentions,h=p.urlPreview,v=p.embeddedLinks,f=Object(s.map)(m,function(e){var t=e.userId,n=Object(a.__rest)(e,["userId"]);return Object(a.__assign)(Object(a.__assign)({},n),{userId:t,id:t});}),b=Object(s.map)(o,function(e){var t=e.chicletBreadcrumbs,n=Object(a.__rest)(e,["chicletBreadcrumbs"]);return Object(a.__assign)({previewUrl:"",previewWidth:null,previewHeight:null,chicletBreadcrumbs:t?{__typename:"ChicletBreadcrumbs",sourceChannelName:t.sourceChannelName||null,sourceTeamName:t.sourceTeamName||null}:null},n);}),y=function(e){return e?Object(a.__assign)(Object(a.__assign)({},e),{thumbnailMeta:e.thumbnailMeta?Object(a.__assign)(Object(a.__assign)({},e.thumbnailMeta),{__typename:"ImageMeta"}):null,__typename:"UrlPreview"}):null;}(h),_=(d=v)?d.map(function(e){var t=e.fileShareUrlMeta?Object(a.__assign)(Object(a.__assign)({},e.fileShareUrlMeta),{__typename:"FileShareUrlMeta"}):null;return Object(a.__assign)(Object(a.__assign)({},e),{__typename:"EmbeddedLink",fileShareUrlMeta:t});}):null;return Object(a.__assign)({content:n,contentType:"text",messageType:r,clientMessageId:i,isImportant:u===g.a.MessageImportance.Important,status:g.a.MessageStatus.Delivered,mentions:f,files:b,deeplinks:_t(c),urlPreview:y,embeddedLinks:_,emotions:null},t);},Ct="ChatResolvers",wt=207,It=206,Mt=40318;function Tt(e){return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(t){switch(t.label){case 0:return[4,e.getUser()];case 1:return[2,t.sent().profile.oid];}});});}function kt(e,t,n,r,i){return Object(a.__awaiter)(this,void 0,Promise,function(){var s,o,c,u,l,p;return Object(a.__generator)(this,function(a){switch(a.label){case 0:if(s=[],o=i.newLogger("Chat Resolvers"),c=r.get(d.a.Messaging).enableInformationBarrierInMW,u=new m.a(n).enableInformationBarrier,!(c&&u)||e!==wt)return[2,s];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t.json()];case 2:return(l=a.sent())&&l.multipleStatus&&l.multipleStatus.forEach(function(e){e&&e.statusCode===It&&e.statusSubCode===Mt&&s.push({id:e.id});}),[2,s];case 3:return p=a.sent(),o.error("fail to check for IB rejected users: "+p),[2,s];case 4:return[2];}});});}function Et(e,t,n,r,i){return Object(a.__awaiter)(this,void 0,Promise,function(){var s;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return[4,kt(e,t,n,r,i)];case 1:return[2,(s=a.sent())&&s.length>0];}});});}var Lt,Dt,Ut={Query:{chats:function chats(e,t,n){var r=t.first,i=t.after,s=n.getCSAService,o=n.loggerFactory,c=n.user;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,u,l,d,p;return Object(a.__generator)(this,function(a){switch(a.label){case 0:e=[],t=null,n=null,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,s()];case 2:return[4,a.sent().getChats(r,i)];case 3:return u=a.sent(),l=u.items,d=u.continuationToken,t=d,e=l.map(function(e){return function(e,t,n){return{node:Ee(e,t,n),cursor:e.createdAt||e.id};}(e,o,c);}),n=!!t,[3,5];case 4:return p=a.sent(),o.newLogger("Chats Resolver").error("Unable to resolve chats: ",p),[2,Promise.reject(p)];case 5:return[2,{edges:e,pageInfo:{endCursor:t,hasNextPage:n}}];}});});},messages:function messages(e,t,n){var r=t.convId,i=t.cursor,s=n.getCSAService,o=n.loggerFactory;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return Ze(r)?[2,{messages:[]}]:[3,1];case 1:return[4,s()];case 2:return[4,a.sent().getMessages(r,i)];case 3:return e=a.sent(),t=e.messages,n=e.messageToken,[2,{messages:t.map(function(e){return fe(e,o);}).sort(function(e,t){var n=new Date(e.originalArrivalTime);return new Date(t.originalArrivalTime).valueOf()-n.valueOf();}),cursor:n,dataSource:"network"}];}});});},message:function message(e,t,n){var r=t.convId,i=t.messageId,s=n.getCSAService,o=n.loggerFactory;return Object(a.__awaiter)(this,void 0,void 0,function(){var e;return Object(a.__generator)(this,function(t){switch(t.label){case 0:return[4,s()];case 1:return[4,t.sent().getMessage(r,i)];case 2:return e=t.sent(),[2,{message:fe(e,o)}];}});});},chat:function chat(e,t,n){var r=t.convId,i=n.getCSAService,s=n.getPeopleService,o=n.loggerFactory,c=n.user;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t;return Object(a.__generator)(this,function(n){switch(n.label){case 0:return[4,i()];case 1:return e=n.sent(),[4,s()];case 2:return t=n.sent(),[2,ht(r,e,o,t,void 0,c)];}});});},chatWithUser:function chatWithUser(e,t,n){var r=t.userId,i=t.createLieIfNotFound,s=n.getCSAService,c=n.discover,u=n.getPeopleService,l=n.loggerFactory,d=n.user,m=n.cache;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,g,h,v,f,b,y;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return[4,c.skypeid()];case 1:return e=a.sent(),t=Object(et.a)(e,r),n=null,[4,s()];case 2:g=a.sent(),a.label=3;case 3:return a.trys.push([3,6,,7]),h=ht,v=[t,g,l],[4,u()];case 4:return[4,h.apply(void 0,v.concat([a.sent(),void 0,d]))];case 5:return n=a.sent(),[3,7];case 6:if(f=a.sent(),!Object(w.g)(f,p.d.RequireStatus,p.c.RemoteOperationFailed,{requiredStatus:p.h.OK,status:p.h.NOT_FOUND}))throw f;return[3,7];case 7:return n||!i?[3,10]:(b=Ot,y=[[e,r]],[4,u()]);case 8:return[4,b.apply(void 0,y.concat([a.sent()]))];case 9:n=a.sent();try{m.writeQuery({query:o,variables:{convId:n.id},data:{chat:n}});}catch(e){throw e;}a.label=10;case 10:return[2,n];}});});},chatsWithUsers:function chatsWithUsers(e,t,n){var r=t.userIds,i=t.filters,s=t.partialMatch,c=t.topicName,u=t.createLieIfNotFound,l=n.cache,d=n.getCSAService,p=n.getPeopleService,m=n.loggerFactory,g=n.user,h=n.pubsub;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,v,f,b;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return e=[],[4,d()];case 1:return[4,a.sent().getChatsWithUsers(r,!!s)];case 2:return(t=a.sent())&&(e=Ye(t.map(function(e){return Ee(e,m,g);}),i||{}),c&&(e=e.filter(function(e){return e.title===c;}))),0===e.length&&u?(v=Ot,f=[r],[4,p()]):[3,5];case 3:return[4,v.apply(void 0,f.concat([a.sent(),c]))];case 4:n=a.sent();try{l.writeQuery({query:o,variables:{convId:n.id},data:{chat:n}});}catch(e){throw e;}b=ve(n.id,n.title,n.members),h.publish("draftChatUpdate",{chat:b,action:B.Add}),e.push(n),a.label=5;case 5:return[2,e];}});});},unreadCounts:function unreadCounts(e,t,n){var r=n.getCSAService;return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(e){switch(e.label){case 0:return[4,r()];case 1:return[4,e.sent().getBadges()];case 2:return[2,e.sent().map(Le)[0]];}});});},chatsByTitle:function chatsByTitle(e,t,n){var r=t.title,i=t.filters,s=n.getCSAService,o=n.loggerFactory,c=n.user;return Object(a.__awaiter)(this,void 0,void 0,function(){var e;return Object(a.__generator)(this,function(t){switch(t.label){case 0:return[4,s()];case 1:return[4,t.sent().getChatsByTitle(r)];case 2:return[2,(e=t.sent())?Ye(e.map(function(e){return Ee(e,o,c);}),i||{}):[]];}});});},membersConsumptionHorizon:function membersConsumptionHorizon(e,t,n){var r=t.convId,i=n.getChatService,s=n.getCSAService,o=n.loggerFactory,c=n.settingsService;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t;return Object(a.__generator)(this,function(n){switch(n.label){case 0:return[4,s()];case 1:return e=n.sent(),[4,i()];case 2:return t=n.sent(),[2,yt(r,t,e,o,c)];}});});},searchUsersByConversation:function searchUsersByConversation(e,t,n){var r=t.convId,i=t.searchQuery,o=t.searchExactMatches,c=n.getCSAService,u=n.discover,l=n.getPeopleService,d=n.loggerFactory,p=n.user;return Object(a.__awaiter)(this,void 0,Promise,function(){var e,t,n,m,g,h,v,f,b,y,_;return Object(a.__generator)(this,function(a){switch(a.label){case 0:if(!r)throw new Error("ConvId null not supported");return[4,c()];case 1:return e=a.sent(),n=ht,m=[r,e,d],[4,l()];case 2:return[4,n.apply(void 0,m.concat([a.sent(),void 0,p]))];case 3:if(!(t=a.sent()))throw new Error("Conversation could not be found, convId - "+r);if(g=t.members,i){if(h=i.indexOf("@"),2,v=-1!==h,f=i.substring(h).replace(" "," ").replace(/^@/,""),g.length<=2&&!v)return[2,[]];f&&(b=Object(s.escapeRegExp)(f),y=!v&&o?new RegExp("(?:^|\\W)"+b+"(?:$|\\W)","i"):new RegExp("((?:^|\\b|\\.)"+b+")","i"),g=Object(s.filter)(g,function(e){return!Object(s.isNil)(e)&&!Object(s.isNil)(e.displayName)&&y.test(e.displayName)||!Object(s.isNil)(e.email)&&y.test(e.email);}));}return[4,u.skypeid()];case 4:return _=a.sent(),g=Object(s.filter)(g,function(e){return e.id!==_;}),5,[2,g=Object(s.take)(g,5)];}});});}},Mutation:{createDraftChat:function createDraftChat(e,t,n){var r=t.chat,i=t.action,s=n.pubsub;return Object(a.__awaiter)(this,void 0,void 0,function(){var e;return Object(a.__generator)(this,function(t){return e=ve(r.id,r.title),s.publish("draftChatUpdate",{chat:e,action:i}),[2,{chat:e,action:i}];});});},sendMessage:function sendMessage(e,t,n){var r=t.convId,i=t.message,o=t.action,c=n.authenticationService,u=n.discover,l=n.getChatService,d=n.getPeopleService,p=n.getCSAService;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,m,g,h,v,f,b,y,_,j,S,C,w,I,M,T,k,E,L;return Object(a.__generator)(this,function(D){switch(D.label){case 0:return[4,Promise.all([c.getUser(),u.skypeid()])];case 1:return e=D.sent(),t=e[0].profile.name,n=e[1],[4,l()];case 2:return m=D.sent(),function(e){return Qe(e)||Xe(e)||O(e);}(r)?[4,m.getThread(r)]:[3,7];case 3:return f=D.sent(),[4,u.skypeid()];case 4:return b=D.sent(),_=gt,j=[f.members],[4,d()];case 5:return[4,_.apply(void 0,j.concat([D.sent()]))];case 6:y=D.sent(),S=Object(s.find)(y,function(e){return e.mri===b;}),h=S&&S.sipProxyAddress,C=Object(s.find)(y,function(e){return e.mri!==b;}),v=C&&C.sipProxyAddress,g="receiverSfB",i=Object(a.__assign)(Object(a.__assign)({},i),{messageType:"Text"}),D.label=7;case 7:return(w=function(e){var t;return"BotMessageBack"===(null==e?void 0:e.messageType)&&(t=!0),t;}(i))&&i&&(i=Object(a.__assign)(Object(a.__assign)({},i),{messageType:"Text"})),I=function(e,t,n){void 0===n&&(n={fromSipUri:void 0,toSipUri:void 0,interopType:void 0,skipFanoutToBots:void 0});var r=e.content,i=e.importance,s=e.subject,o=e.files,c=e.computed,u=void 0===c?{}:c,l=e.id,d=e.messageType,p=e.clientMessageId,m=u,g=m.urlPreview,h=m.mentions,v=m.cards,f=m.embeddedLinks;return{id:l,messagetype:d,contenttype:"text",content:r,imdisplayname:t,clientmessageid:p,amsreferences:u.amsReferences,fromSipUri:n&&n.fromSipUri||void 0,toSipUri:n&&n.toSipUri||void 0,properties:Object(a.__assign)({importance:P(i),subject:s,cards:ae(v),links:mt(g?[g]:[],f||[]),mentions:De(h),files:ie(o),policyViolation:e.policyViolation,interopType:n&&n.interopType},void 0!==(null==n?void 0:n.skipFanoutToBots)&&{skipfanouttobots:n.skipFanoutToBots})};}(i,t,{fromSipUri:h,toSipUri:v,interopType:g,skipFanoutToBots:w}),i&&i.scheduledSendTime?[4,p()]:[3,10];case 8:return[4,D.sent().postScheduledMessage(r,i,i.scheduledSendTime,o)];case 9:return D.sent(),[2,Promise.resolve({convId:r,message:i,action:o})];case 10:switch(o){case tt.Cc.Create:return[3,11];case tt.Cc.Update:return[3,13];}return[3,15];case 11:return[4,m.postMessageToConversation(r,I)];case 12:return M=D.sent(),E=M.id,T=M.originalarrivaltime,[2,St(i,{id:E,originalArrivalTime:new Date(T).toISOString(),from:n,imDisplayName:n})];case 13:return[4,m.updateMessageInConversation(r,I)];case 14:return D.sent(),E=(k=i).id,L=k.originalArrivalTime,[2,St(i,{id:E,originalArrivalTime:L,editTime:new Date().toISOString(),from:n,imDisplayName:n})];case 15:throw new RangeError("Invalid action type for sendMessage");}});});},createChat:function createChat(e,t,n){var r=t.userIds,i=t.topicName;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,o,c,u,l,d,p,m,g,h,v,f,b,y,_,O,j,S;return Object(a.__generator)(this,function(C){switch(C.label){case 0:return e=n.coreSettings,t=n.getChatService,o=n.getCSAService,c=n.discover,u=n.getPeopleService,l=n.loggerFactory,d=n.settingsService,p=n.user,[4,c.skypeid()];case 1:return m=C.sent(),g=function(e,t){return t&&Object(s.remove)(t,function(t){return t===e;}),t&&Object(a.__spreadArrays)([{id:e,role:"Admin"}],t.map(function(e){return{id:e,role:"Admin"};}));}(m,r),[4,t()];case 2:return h=C.sent(),[4,jt(h,r,g,i||"")];case 3:return v=C.sent(),f=v.threadId,b=v.status,y=v.responseBody,[4,Et(b,y,d,e,l)];case 4:return _=C.sent(),[4,o()];case 5:return O=C.sent(),j=ht,S=[f,O,l],[4,u()];case 6:return[4,j.apply(void 0,S.concat([C.sent(),void 0,p]))];case 7:return[2,{conversation:C.sent(),hasIBPolicyRejectedUsers:_}];}});});},addMembersToConversation:function addMembersToConversation(e,t,n){var r=t.convId,i=t.members,o=t.shareHistoryTime,c=n.coreSettings,u=n.getChatService,l=n.getPeopleService,d=n.loggerFactory,p=n.settingsService;return Object(a.__awaiter)(this,void 0,Promise,function(){var e,t,n,m,g;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return[],e=!1,Ze(r)?[3,4]:(!Object(s.isNil)(o)&&o>0&&(864e5,o=Date.now()-864e5*o),[4,u()]);case 1:return[4,a.sent().addMembersToThread(r,i,Object(s.isNil)(o)?void 0:o)];case 2:return[4,kt((t=a.sent()).status,t.body,p,c,d)];case 3:n=a.sent(),e=n&&n.length>0,Object(s.pullAllBy)(i,n,"id"),a.label=4;case 4:return m=gt,g=[i],[4,l()];case 5:return[4,m.apply(void 0,g.concat([a.sent()]))];case 6:return[2,{users:a.sent(),hasIBPolicyRejectedUsers:e}];}});});},removeMemberFromConversation:function removeMemberFromConversation(e,t,n){var r=t.convId,i=t.userId,s=n.getChatService;return Object(a.__awaiter)(this,void 0,Promise,function(){return Object(a.__generator)(this,function(e){switch(e.label){case 0:return[4,s()];case 1:return[4,e.sent().removeMemberFromThread(r,i)];case 2:return e.sent(),[2,i];}});});},updateMessageEmotion:function updateMessageEmotion(e,t,n){var r=t.convId,i=t.messageId,s=t.key,o=t.action,c=n.discover,u=n.getChatService;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t;return Object(a.__generator)(this,function(n){switch(n.label){case 0:return[4,c.skypeid()];case 1:return e=n.sent(),[4,u()];case 2:if(t=n.sent(),!s)return[2,o===g.a.EmotionAction.remove?{id:""}:{id:e}];switch(o){case g.a.EmotionAction.add:return[3,3];case g.a.EmotionAction.remove:return[3,5];}return[3,7];case 3:return[4,t.addMessageEmotion(r,i,s)];case 4:return n.sent(),[2,{id:e}];case 5:return[4,t.removeMessageEmotion(r,i,s)];case 6:return n.sent(),[2,{id:""}];case 7:throw Object(w.a)(Ct,p.c.NotImplemented,"updateMessageEmotion",{action:o});}});});},saveMessage:function saveMessage(e,t,n){var r=t.convId,i=t.messageId,s=n.discover,o=n.getChatService;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,c,u,l,d,m,h,v;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return e=g.a.EmotionKey.star,[4,s.skypeid()];case 1:return t=a.sent(),[4,o()];case 2:return[4,(n=a.sent()).getConversationMessage(r,i)];case 3:if(c=a.sent(),Ke(e,t,c))throw Object(w.a)(Ct,p.c.AlreadyPresent,"saveMessage");return[4,n.addMessageEmotion(r,i,e)];case 4:a.sent(),a.label=5;case 5:return a.trys.push([5,7,,9]),u=function(e){var t=e.id,n=e.conversationid,r=e.imdisplayname,i=e.from,a=e.composetime;return t&&{"@type":"http://schema.skype.com/StarredMessage",mri:G(i),imdisplayname:r,messageId:t,parentMessageId:t,threadId:n,isUnresolvedEmailUser:!1,originalComposeTime:a};}(c),l=c.messagetype,d=c.content,m=c.imdisplayname,h={messagetype:l,content:d,imdisplayname:m,properties:{starred:u}},[4,n.postMessageToConversation("48:starred",h)];case 6:return a.sent(),[3,9];case 7:return v=a.sent(),[4,n.removeMessageEmotion(r,i,e)];case 8:throw a.sent(),v;case 9:return[2,{id:t}];}});});},unsaveMessage:function unsaveMessage(e,t,n){var r=t.convId,i=t.messageId,s=n.getChatService,o=n.getCSAService,c=n.discover;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,u,l,d,m;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return e=g.a.EmotionKey.star,[4,c.skypeid()];case 1:return t=a.sent(),[4,s()];case 2:return[4,(n=a.sent()).getConversationMessage(r,i)];case 3:if(u=a.sent(),!Ke(e,t,u))throw Object(w.a)(Ct,p.c.NotPresent,"unsaveMessage");return[4,n.removeMessageEmotion(r,i,e)];case 4:a.sent(),a.label=5;case 5:return a.trys.push([5,10,,12]),[4,o()];case 6:return[4,a.sent().getMessages("48:starred")];case 7:return l=a.sent().messages,(d=function(e,t,n){var r=n.find(function(n){try{var r=JSON.parse((n.properties||{}).starred),i=r&&"http://schema.skype.com/StarredMessage"===r["@type"]&&r.threadId===t?r.messageId:void 0;return e===i;}catch(e){return!1;}});return r&&r.id;}(i,r,l))?[4,n.markStarredMessageAsDeleted(d)]:[3,9];case 8:a.sent(),a.label=9;case 9:return[3,12];case 10:return m=a.sent(),[4,n.addMessageEmotion(r,i,e)];case 11:throw a.sent(),m;case 12:return[2,null];}});});},deleteMessage:function deleteMessage(e,t,n){var r=t.convId,i=t.messageId,s=n.getChatService;return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(e){switch(e.label){case 0:return[4,s()];case 1:return[4,e.sent().deleteMessage(r,i)];case 2:return e.sent(),[2,{id:i}];}});});},undeleteMessage:function undeleteMessage(e,t,n){var r=t.convId,i=t.messageId,s=n.getChatService;return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(e){switch(e.label){case 0:return[4,s()];case 1:return[4,e.sent().undeleteMessage(r,i)];case 2:return e.sent(),[2,{id:i}];}});});},sendTypingIndicator:function sendTypingIndicator(e,t,n){var r=t.convId,i=n.getChatService;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,s;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return e={messagetype:"Control/Typing",contenttype:"Application/Message",content:""},[4,i()];case 1:return[4,a.sent().postMessageToConversation(r,e)];case 2:return t=a.sent(),n=t.id,s=t.originalarrivaltime,[2,{id:n,originalArrivalTime:new Date(s).toISOString(),content:e.content,contentType:e.contenttype,messageType:e.messagetype,isImportant:!1,clientMessageId:e.clientmessageid}];}});});},setConsumptionHorizon:function setConsumptionHorizon(e,t,n){var r=t.convId,i=t.message,s=i.originalArrivalTime,o=i.clientMessageId,c=n.getChatService;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n;return Object(a.__generator)(this,function(i){switch(i.label){case 0:e=Date.now(),t=new Date(s||"").valueOf()+";"+e+";"+o,i.label=1;case 1:return i.trys.push([1,4,,5]),[4,c()];case 2:return[4,i.sent().setConversationConsumptionHorizon(r,t)];case 3:return i.sent(),[3,5];case 4:return n=i.sent(),[2,Promise.reject(n)];case 5:return[2,{id:r,timeStamp:new Date(e).toISOString(),originalArrivalTime:s,clientMessageId:o}];}});});},setConsumptionHorizonBookmark:function setConsumptionHorizonBookmark(e,t,n){var r=t.convId,i=t.message,s=i.originalArrivalTime,o=i.clientMessageId,c=n.getChatService;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,i,u;return Object(a.__generator)(this,function(a){switch(a.label){case 0:e=Date.now(),t=new Date(s||""),n="0"===s?"0":""+(t.valueOf()-1),i=n+";"+e+";"+o,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,c()];case 2:return[4,a.sent().setConversationConsumptionHorizon(r,i,!0)];case 3:return a.sent(),[3,5];case 4:return u=a.sent(),[2,Promise.reject(u)];case 5:return[2,{id:r,timeStamp:new Date(e).toISOString(),originalArrivalTime:"0"===n?"0":new Date(t.valueOf()-1).toISOString(),clientMessageId:o}];}});});},updateMessageLinks:function updateMessageLinks(e,t,n){var r=t.convId,i=t.messageId,s=t.links,o=n.getChatService;return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(e){switch(e.label){case 0:return[4,o()];case 1:return[4,e.sent().updateMessageLinks(r,i,{links:s})];case 2:return e.sent(),[2,!0];}});});}},Subscription:{createDraftChatEvent:{subscribe:function subscribe(e,t,n){var r=n.pubsub;return Object(a.__asyncGenerator)(this,arguments,function(){var e,t,n,i,s,o,c,u;return Object(a.__generator)(this,function(l){switch(l.label){case 0:(o={})[Symbol.asyncIterator]=function(){return r.asyncIterator("draftChatUpdate");},e=o,l.label=1;case 1:l.trys.push([1,8,9,14]),t=Object(a.__asyncValues)(e),l.label=2;case 2:return[4,Object(a.__await)(t.next())];case 3:return(n=l.sent()).done?[3,7]:(i=n.value)?[4,Object(a.__await)({createDraftChatEvent:i})]:[3,6];case 4:return[4,l.sent()];case 5:l.sent(),l.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return s=l.sent(),c={error:s},[3,14];case 9:return l.trys.push([9,,12,13]),n&&!n.done&&(u=t.return)?[4,Object(a.__await)(u.call(t))]:[3,11];case 10:l.sent(),l.label=11;case 11:return[3,13];case 12:if(c)throw c.error;return[7];case 13:return[7];case 14:return[2];}});});}},chatServiceEvent:{subscribe:function subscribe(e,t,n){var r=t.conversationId,i=n.authenticationService,s=n.getChatService,o=n.getChatServiceEndpointProvider,c=n.getPeopleService,u=n.getStatefulLongPoll,d=n.loggerFactory,m=n.user;return Object(a.__asyncGenerator)(this,arguments,function(){var e,t,n,g,h,v,f,b,y,_,O,j,S,C=this;return Object(a.__generator)(this,function(I){switch(I.label){case 0:return e=function e(_e2){return Object(a.__awaiter)(C,void 0,void 0,function(){var t,n;return Object(a.__generator)(this,function(r){switch(r.label){case 0:return t=gt,n=[_e2],[4,c()];case 1:return[2,t.apply(void 0,n.concat([r.sent()]))];}});});},[4,Object(a.__await)(s())];case 1:return t=I.sent(),[4,Object(a.__await)(o?o():Promise.resolve(void 0))];case 2:return n=I.sent(),[4,Object(a.__await)(u?u():Promise.resolve(void 0))];case 3:if(g=I.sent(),!n||!g)throw Object(w.a)(Ct,p.c.NotPresent,"chatServiceEvent");return[4,Object(a.__await)(Tt(i))];case 4:h=I.sent(),v=g.poll({chatService:t,chatServiceEndpointProvider:n,currentUserId:h,sendActiveTimeoutParam:!1}),I.label=5;case 5:I.trys.push([5,13,14,19]),f=Object(a.__asyncValues)(l(v)),I.label=6;case 6:return[4,Object(a.__await)(f.next())];case 7:return(b=I.sent()).done?[3,12]:(y=b.value,[4,Object(a.__await)(Je(y,e,d,m))]);case 8:if(!(_=I.sent()))return[3,11];if(r){if(("ThreadUpdate"===_.__typename||"ConversationUpdate"===_.__typename)&&_.conversation.id!==r)return[3,11];if("NewMessage"===_.__typename&&_.convId!==r)return[3,11];}return[4,Object(a.__await)({chatServiceEvent:_})];case 9:return[4,I.sent()];case 10:I.sent(),I.label=11;case 11:return[3,6];case 12:return[3,19];case 13:return O=I.sent(),j={error:O},[3,19];case 14:return I.trys.push([14,,17,18]),b&&!b.done&&(S=f.return)?[4,Object(a.__await)(S.call(f))]:[3,16];case 15:I.sent(),I.label=16;case 16:return[3,18];case 17:if(j)throw j.error;return[7];case 18:return[7];case 19:return[2];}});});}},chatServicePostActiveEvent:{subscribe:function subscribe(e,t,n){var r=n.authenticationService,i=n.getChatServiceEndpointProvider,s=n.getChatService;return Object(a.__asyncGenerator)(this,arguments,function(){var e,t;return Object(a.__generator)(this,function(n){switch(n.label){case 0:return[4,Object(a.__await)(s())];case 1:return e=n.sent(),[4,Object(a.__await)(i())];case 2:return t=n.sent(),[5,Object(a.__values)(Object(a.__asyncDelegator)(Object(a.__asyncValues)(ct(e,t,function(){return Tt(r);}))))];case 3:return[4,a.__await.apply(void 0,[n.sent()])];case 4:return n.sent(),[2];}});});}}}},Pt=n("O9iK");!function(e){e[e.Sync=1]="Sync",e[e.LongPoll=2]="LongPoll",e[e.SfB=3]="SfB",e[e.SyncRelated=4]="SyncRelated",e[e.Local=5]="Local",e[e.CSAReplyChain=6]="CSAReplyChain",e[e.DeltaSync=7]="DeltaSync";}(Lt||(Lt={})),function(e){e[e.Sending=0]="Sending",e[e.Delivered=1]="Delivered",e[e.Received=2]="Received",e[e.Error=3]="Error",e[e.Deleted=4]="Deleted";}(Dt||(Dt={}));var Nt,At,Rt=function(){function e(t){this.id=t.id,this.conversationId=t.conversationId,this.parentMessageId=t.parentMessageId,this.clientMessageId=t.clientMessageId,this.sequenceId=t.sequenceId||0,this.version=t.version,this.type=t.type||"",this.contentType=t.contentType||"",this.activityType=t.activityType||"",this.messageType=t.messageType,this.clientArrivalTime=t.clientArrivalTime,this.originalArrivalTime=t.originalArrivalTime,this.imDisplayName=t.imDisplayName,this.creator=t.creator,this.skypeGuid=t.skypeGuid,this.properties=t.properties||{},this.source=t.source,this._content=t.content,this._isSanitized=t.isSanitized,this.translation=t.translation,this.annotationsSummary=t.annotationsSummary,this.state=t.state,this.searchKey=e.createSearchKey(t.conversationId,t.id),this.dedupeKey=t.dedupeKey||this.creator+"_"+(this.clientMessageId||this.id),this.originalNonLieMessage=t.originalNonLieMessage;}return e.createSearchKey=function(e,t){return e+"_"+t;},e.FromChatServiceMessage=function(t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=Dt.Delivered);var o=Object(a.__assign)(Object(a.__assign)({},t),{conversationId:e.getConversationId(t),parentMessageId:e.getParentMessageId(t),clientMessageId:t.clientmessageid||"",sequenceId:t.sequenceId||0,imDisplayName:t.imdisplayname||"",creator:Object(s.last)(Object(s.split)(t.from,"/"))||"",messageType:t.messagetype,contentType:t.contenttype||"",activityType:t.activitytype||"",skypeGuid:t.skypeguid,originalArrivalTime:e.getOriginalArrivaTimeUtc(t.originalarrivaltime),source:n,clientArrivalTime:Date.now(),dedupeKey:"",searchKey:e.createSearchKey(e.getConversationId(t),t.id),state:i,isSanitized:r});return new e(o);},e.shouldUseExistingMessage=function(e,t){return(!e.isClientLie||!t.isClientLie||e.state!==Dt.Sending||t.state!==Dt.Error)&&!(e.sequenceId<t.sequenceId)&&e.version>=t.version;},e.FromCSAMessage=function(t){var n=Object(a.__assign)(Object(a.__assign)({},t),{conversationId:t.containerId,originalArrivalTime:e.getOriginalArrivaTimeUtc(t.originalArrivalTime),parentMessageId:t.parentMessageId||t.id,sequenceId:t.sequenceId||0,source:Lt.CSAReplyChain,creator:t.from,version:t.version.toString(),clientArrivalTime:Date.now(),dedupeKey:"",searchKey:e.createSearchKey(t.containerId,t.id),isSanitized:!1,state:Dt.Delivered});return new e(n);},e.isClientLieId=function(t){return t===e.ClientLieId||Object(s.startsWith)(t,e.ClientLiePrefix);},e.getParentMessageId=function(t){var n=Object(s.flow)(function(e){return Object(s.split)(e,"/");},function(e){return Object(s.last)(e);},function(e){return Object(s.split)(e,"=");},function(e){return Object(s.nth)(e,1);})(t.conversationLink);return n=n||t.id,e.isClientLieId(n)?e.ClientLieId:n;},e.getConversationId=function(e){return Object(s.flow)(function(e){return Object(s.split)(e,"/");},function(e){return Object(s.last)(e);},function(e){return Object(s.split)(e,";");},function(e){return Object(s.first)(e);})(e.conversationLink)||"";},e.getOriginalArrivaTimeUtc=function(e){return e?new Date(e).getTime():-1;},Object.defineProperty(e.prototype,"key",{get:function get(){return this.dedupeKey;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSanitized",{get:function get(){return this._isSanitized;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function get(){return this._content;},enumerable:!0,configurable:!0}),e.prototype.sanitizeContent=function(e){if(this.shouldSkipSanitization())this._isSanitized=!0;else{var t=this.content;this.messageType!==v.l.HTML||this.isGatewayChatMessage||(t="<div>"+t+"</div>"),t=(t=e.sanitizeHtml(t)).replace(/}}/g,"}<span>}</span>"),this._content=t,this._isSanitized=!0;}},Object.defineProperty(e.prototype,"isEdited",{get:function get(){return!!this.properties[v.k.EditTime];},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editedTime",{get:function get(){return this.isEdited?Number(this.properties[v.k.EditTime]):void 0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDeleted",{get:function get(){return!!this.properties[v.k.DeleteTime];},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deletedTime",{get:function get(){return this.isDeleted?Number(this.properties[v.k.DeleteTime]):void 0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isClientLie",{get:function get(){return this.id===e.ClientLieId;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEditClientLie",{get:function get(){return this.isEdited&&this.source===Lt.Local;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isGatewayChatMessage",{get:function get(){return e=this.conversationId,t=Object(s.endsWith)(e,v.g)||Object(s.endsWith)(e,v.f)||Object(s.startsWith)(e,v.n),n=e.endsWith(v.t),r=O(e),t||n||r;var e,t,n,r;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSystemMessage",{get:function get(){return Object(s.includes)(v.B,this.messageType);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRootMessage",{get:function get(){return this.id===this.parentMessageId;},enumerable:!0,configurable:!0}),e.prototype.isSentByUser=function(e){return this.creator===e;},e.prototype.toDBSchema=function(){return{id:this.id,dedupeKey:this.dedupeKey,conversationId:this.conversationId,parentMessageId:this.parentMessageId,clientMessageId:this.clientMessageId,sequenceId:this.sequenceId,version:this.version,searchKey:this.searchKey,type:this.type,contentType:this.contentType,activityType:this.activityType,messageType:this.messageType,clientArrivalTime:this.clientArrivalTime,originalArrivalTime:this.originalArrivalTime,imDisplayName:this.imDisplayName,creator:this.creator,content:this.content,source:this.source,properties:this.properties,skypeGuid:this.skypeGuid,translation:this.translation,isSanitized:this.isSanitized,originalNonLieMessage:this.originalNonLieMessage,annotationsSummary:this.annotationsSummary,state:this.state};},e.prototype.toLegacySchema=function(){var e=this.source===Lt.DeltaSync?Lt.Sync:this.source,t=this.toChatServiceSchema(),n=t.message,r=t.isPlainTextConvertedToHtml;return Object(a.__assign)(Object(a.__assign)({},n),{clientArrivalTime:new Date(this.clientArrivalTime).toISOString(),source:e,isSanitized:this.isSanitized,isPlainTextConvertedToHtml:r});},e.prototype.toIntermediateSchemaForServerConversion=function(e){var t=this.toChatServiceSchema().message;return{id:t.id,content:t.content,originalarrivaltime:t.originalarrivaltime,imdisplayname:t.imdisplayname,from:t.from,messagetype:t.messagetype,properties:t.properties,skypeguid:t.skypeguid,clientmessageid:t.clientmessageid,translation:t.translation,version:t.version,annotationsSummary:t.annotationsSummary,userHasStarred:Object(h.f)(this.properties,e),callId:this.skypeGuid};},e.prototype.revertEditLieToOriginalMessage=function(){return!!this.originalNonLieMessage&&(this._content=this.originalNonLieMessage.content,this.translation=this.originalNonLieMessage.translation,this.properties[v.k.EditTime]=this.originalNonLieMessage.editTimeProperty,this.state=Dt.Delivered,!0);},e.prototype.resolveEditLieContent=function(){return this.originalNonLieMessage=void 0,this.state=Dt.Delivered,!0;},e.prototype.copyExistingEditClientLie=function(e){this.originalNonLieMessage=e.originalNonLieMessage,this._content=e.content,this.translation=e.translation,this.state=e.state,this.properties[v.k.EditTime]=e.properties[v.k.EditTime];},e.prototype.shouldSkipSanitization=function(){return Object(s.isEmpty)(this.content)||this.isSanitized||this.isSystemMessage||this.messageType===v.l.Text||this.messageType===v.l.Call||this.messageType===v.l.CallRecording;},e.prototype.toChatServiceSchema=function(){var t=this.content,n=this.messageType,r=!1;this.isSanitized&&n===v.l.Text&&(t="<div>"+Object(s.escape)(t)+"</div>",n=v.l.HTML,r=!0);var i=e.isClientLieId(this.parentMessageId)?""+e.ClientLiePrefix+this.clientMessageId:this.parentMessageId,a="conversation/"+this.conversationId+";messageid="+i;return{message:{content:t,messagetype:n,contenttype:this.contentType,activitytype:this.activityType,clientmessageid:this.clientMessageId,sequenceId:this.sequenceId,imdisplayname:this.imDisplayName,properties:this.properties,state:this.state,id:this.id,type:this.type,composetime:new Date(this.originalArrivalTime).toISOString(),originalarrivaltime:new Date(this.originalArrivalTime).toISOString(),from:"worker/"+this.creator,conversationLink:a,version:this.version,skypeguid:this.skypeGuid,translation:this.translation,annotationsSummary:this.annotationsSummary},isPlainTextConvertedToHtml:r};},e.ClientLieId="-1",e.ClientLiePrefix="clientId_",e;}(),Bt=function(){function e(t){var n=this;if(this.latestDeliveryTime=0,this.messageMap={},this.messageSearchKeys=[],Object(s.isEmpty)(t))throw new Error("Empty Object - cannot create a replychain");if(e.isDBSchema(t))this.replyChainId=t.replyChainId,this.conversationId=t.conversationId,this.latestDeliveryTime=t.latestDeliveryTime,this.messageSearchKeys=t.messageSearchKeys,this.lastUpdatedBy=t.lastUpdatedBy,Object(s.forEach)(t.messageMap,function(e,t){n.messageMap[t]=new Rt(e);});else{var r=t.messages;if(Object(s.isEmpty)(r))throw new Error("Must pass at least one message to build a reply chain");this.replyChainId=r[0].parentMessageId,this.conversationId=r[0].conversationId,r=Object(s.sortBy)(r,function(e){return e.originalArrivalTime;}),this.messageMap=Object(s.keyBy)(r,function(e){return e.key;}),this.lastUpdatedBy=t.source,this.updateSearchKeysAndLatestDeliveryTime();}}return e.isDBSchema=function(e){return"replyChainId"in e&&"conversationId"in e;},e.fromSkypeMessages=function(t,n){if(Object(s.isEmpty)(t))throw new Error("SkypeReplyChainCDL - fromSkypeMessages: Need at least one message to create a SkypeReplyChain");return Object(s.flow)(function(e){return Object(s.map)(e,function(e){return Rt.FromChatServiceMessage(e,n,!1,e.state);});},function(e){return Object(s.groupBy)(e,function(e){return e.parentMessageId;});},function(t){return Object(s.map)(t,function(t){return new e({messages:t,source:n});});})(t);},e.fromCSAReplyChain=function(t){if(Object(s.isEmpty)(t))throw new Error("SkypeReplyChainCDL - fromCSAReplyChain: CSA replychain is empty");var n=Lt.CSAReplyChain,r=Object(s.flow)(function(e){return Object(s.map)(e,function(e){return Rt.FromCSAMessage(e);});},function(e){return Object(s.groupBy)(e,function(e){return e.parentMessageId;});},function(t){return Object(s.map)(t,function(t){return new e({messages:t,source:n});});})(t.messages);return Object(s.first)(r);},e.getClientLieDBKey=function(e){return[e,Rt.ClientLieId];},e.getClientLieKey=function(t){return e.getClientLieDBKey(t).toString();},e.isRootPresent=function(e){return Object(s.some)(e.messageMap,function(t){return t.id===e.replyChainId;});},Object.defineProperty(e.prototype,"id",{get:function get(){return this.replyChainId;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function get(){return this.dbKey.toString();},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dbKey",{get:function get(){return[this.conversationId,this.replyChainId];},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isClientLieReplyChain",{get:function get(){return this.id===Rt.ClientLieId;},enumerable:!0,configurable:!0}),e.prototype.sanitizeContent=function(e){Object(s.forEach)(this.messageMap,function(t){return t.sanitizeContent(e);});},Object.defineProperty(e.prototype,"messages",{get:function get(){return Object(s.values)(this.messageMap);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSanitized",{get:function get(){return Object(s.every)(this.messages,function(e){return e.isSanitized;});},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"earliestMessage",{get:function get(){return this.hasMessages()?Object(s.minBy)(this.messages,function(e){return e.originalArrivalTime;}):void 0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latestMessage",{get:function get(){return this.hasMessages()?Object(s.maxBy)(this.messages,function(e){return e.originalArrivalTime;}):void 0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentMessage",{get:function get(){return this.hasMessages()?Object(s.find)(this.messages,function(e){return e.id===e.parentMessageId;}):void 0;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"messageCount",{get:function get(){return Object(s.size)(this.messageMap);},enumerable:!0,configurable:!0}),e.prototype.hasMessage=function(e){return e in this.messageMap;},e.prototype.hasMessages=function(){return this.messageCount>0;},e.prototype.getMessage=function(e){return this.messageMap[e];},e.prototype.merge=function(e){var t=this,n=[];return Object(s.forEach)(e.messageMap,function(e,r){var i=t.messageMap[r],a=t.mergeMessages(i,e);a!==i&&(n.push(a.id),t.messageMap[r]=a);}),this.updateSearchKeysAndLatestDeliveryTime(),this.lastUpdatedBy=e.lastUpdatedBy,{replyChain:this,updatedMessageIds:n};},e.prototype.deleteMessages=function(e){var t=this,n=0;return Object(s.forEach)(Object(s.keys)(this.messageMap),function(r){e(t.messageMap[r])&&(delete t.messageMap[r],n++);}),n>0&&this.updateSearchKeysAndLatestDeliveryTime(),n;},e.prototype.toDBSchema=function(){var e={};return Object(s.forEach)(this.messageMap,function(t,n){e[n]=t.toDBSchema();}),{conversationId:this.conversationId,replyChainId:this.replyChainId,latestDeliveryTime:this.latestDeliveryTime,messageMap:e,messageSearchKeys:this.messageSearchKeys,lastUpdatedBy:this.lastUpdatedBy};},e.prototype.toLegacySchema=function(){var e=Object(s.map)(this.messages,function(e){return e.toLegacySchema();});return{conversationId:this.conversationId,replyChainId:this.replyChainId,latestDeliveryTime:this.latestDeliveryTime,messages:e};},e.prototype.tryResolveClientLie=function(e){if(!this.isClientLieReplyChain||!e.isRootMessage||!this.hasMessage(e.key))return!1;var t=Object(s.sortBy)(this.messages,function(e){return e.originalArrivalTime;}),n=Object(s.findIndex)(t,function(t){return t.key===e.key;});return Object(s.forEach)(t,function(t,r){Object(s.set)(t,"originalArrivalTime",e.originalArrivalTime+r-n);}),this.deleteMessages(function(t){return t.key===e.key;}),!0;},e.prototype.revertEditClientLie=function(e){var t=this.getMessage(e.key);return!(!t||!t.isEditClientLie)&&t.revertEditLieToOriginalMessage();},e.prototype.resolveEditClientLie=function(e){var t=this.getMessage(e.key);return!(!t||!t.isEditClientLie)&&t.resolveEditLieContent();},e.prototype.updateSearchKeysAndLatestDeliveryTime=function(){this.messageSearchKeys=Object(s.map)(this.messageMap,function(e){return e.searchKey;});var e=this.latestMessage,t=this.getLatestNonDeletedMessage();this.latestDeliveryTime=t?t.originalArrivalTime:e?e.originalArrivalTime:0;},e.prototype.getLatestNonDeletedMessage=function(){return this.hasMessages()?Object(s.maxBy)(Object(s.filter)(this.messageMap,function(e){return!e.isDeleted;}),function(e){return e.originalArrivalTime;}):void 0;},e.prototype.mergeMessages=function(e,t){return e?Rt.shouldUseExistingMessage(e,t)?e:(t.isDeleted||t.isEdited||(t.translation=e.translation),t.isEditClientLie&&e.isEditClientLie&&e.originalNonLieMessage?t.originalNonLieMessage=e.originalNonLieMessage:t.isEditClientLie?t.originalNonLieMessage={content:e.content,translation:e.translation,editTimeProperty:e.properties[v.k.EditTime]}:e.isEditClientLie&&e.originalNonLieMessage&&t.copyExistingEditClientLie(e),t):t;},e;}();!function(e){e.LoadAll="LOAD_ALL",e.LoadNone="LOAD_NONE",e.Custom="CUSTOM";}(Nt||(Nt={})),function(e){e.CleanupInactive="CLEANUP_INACTIVE";}(At||(At={}));var xt;!function(e){e.latestDeliveryTimeByConversationId="latestDeliveryTimeByConversationId",e.byMessageSearchKeys="byMessageSearchKeys";}(xt||(xt={}));Nt.LoadAll,Nt.LoadAll;var Ft=n("Mo3Q");var zt,Ht=function(){function e(e){var t=this;this._subscriptionObservers=[],this.storeObservables={},e.forEach(function(e){t.storeObservables[e.name]={subscriptionObservers:[],observable:new Ft(function(n){t.storeObservables[e.name].subscriptionObservers.push(n),t.replayEventsForNewSubscriber(e.name,n);}),isDone:!1,lastError:void 0,nextStatesSeen:[],dependentOn:e.dependentOn};}),this._observable=new Ft(function(e){t._subscriptionObservers.push(e);});}return e.prototype.subscribe=function(e,t,n,r){return this.checkStoreName(e),this.storeObservables[e].observable.subscribe({next:t,error:n,complete:r});},e.prototype.changeState=function(e,t,n){this.checkStoreName(e);var r=this.storeObservables[e].subscriptionObservers;if(r&&r.length&&r.forEach(function(e){e.next(t);}),this.storeObservables[e].nextStatesSeen.push(t),t===n)this.complete(e);else{var i=!0;Object(s.forEach)(this.storeObservables,function(e){var n=Object(s.last)(e.nextStatesSeen);(void 0===n||n<t)&&(i=!1);}),i&&Object(s.forEach)(this._subscriptionObservers,function(e){return e.next(t);});}},e.prototype.getDependentStore=function(e){return this.storeObservables[e]&&this.storeObservables[e].dependentOn;},Object.defineProperty(e.prototype,"observable",{get:function get(){return this._observable;},enumerable:!0,configurable:!0}),e.prototype.error=function(e,t){if((r=t)&&void 0!==r.target&&void 0!==r.target.error){var n=t.target.error;t=Object(w.a)("transaction",p.c.WriteToStoreFailed,n&&n.message||"",void 0,Object(w.c)(n));}var r;this.checkStoreName(e);var i=this.storeObservables[e].subscriptionObservers;i&&i.length&&i.forEach(function(e){e.error(t);}),this.storeObservables[e].lastError=t,this.storeObservables[e].isDone=!0,Object(s.forEach)(this._subscriptionObservers,function(e){return e.error(t);});},e.convertObservableToPromise=function(e,t){return new Promise(function(n,r){e.subscribe({next:function next(e){e===t&&n();},error:function error(e){r(e);},complete:function complete(){n();}});});},e.prototype.replayEventsForNewSubscriber=function(e,t){Object(s.forEach)(this.storeObservables[e].nextStatesSeen,function(e){t.next(e);}),this.storeObservables[e].lastError&&t.error(this.storeObservables[e].lastError),this.storeObservables[e].isDone&&t.complete();},e.prototype.complete=function(e){this.storeObservables[e].isDone=!0;var t=this.storeObservables[e].subscriptionObservers;t&&t.length&&t.forEach(function(e){e.complete();});var n=!0;for(var r in this.storeObservables){this.storeObservables[r]&&(n=n&&this.storeObservables[r].isDone&&!this.storeObservables[r].lastError);}n&&Object(s.forEach)(this._subscriptionObservers,function(e){return e.complete();});},e.prototype.checkStoreName=function(e){if(!e||!this.storeObservables[e])throw TypeError("Store name not found in transactions. Name: "+e);},e;}();!function(e){e.MemoryCommitted="MEMORY_COMMITTED",e.DiskCommitted="DISK_COMMITTED";}(zt||(zt={}));var Kt,qt,Gt,Wt,Vt,Jt=function Jt(e){if(["NewMessage","MessageUpdate"].indexOf(e.resourceType)>-1){var t=e.resource;return!!t.messagetype&&(-1!==t.messagetype.indexOf("Control/")||t.messagetype===v.c.MemberConsumptionHorizonUpdate);}return"CustomUserProperties"===e.resourceType;};!function(e){e[e.inMemory=0]="inMemory",e[e.indexedDB=1]="indexedDB",e[e.Network=2]="Network";}(Kt||(Kt={})),function(e){e[e.InsideSyncWindow=0]="InsideSyncWindow",e[e.OutsideSyncWindow=1]="OutsideSyncWindow";}(qt||(qt={})),function(e){e[e.MessageId=1]="MessageId",e[e.ReplyChainId=2]="ReplyChainId",e[e.TimeRange=3]="TimeRange",e[e.ClientLies=4]="ClientLies";}(Gt||(Gt={})),function(e){e.inMemory="inMemory",e.indexedDB="indexedDB",e.network="network";}(Wt||(Wt={})),function(e){e.MainRenderer="MainRenderer",e.Experience="Experience";}(Vt||(Vt={}));var Qt=function Qt(e,t,n){return Object(a.__awaiter)(void 0,void 0,void 0,function(){var r,i,o,u,l,d,m,g,v,f,b,y,_,O,j,S,C;return Object(a.__generator)(this,function(w){switch(w.label){case 0:r=e.correlationId,i=e.conversationId,o=e.deeplinkMessageId,u=n.managers,l=u.replyChainManager,d=u.conversationManager,m=n.workerBootstrapServices,g=m.newScenario,v=m.logger,f=n.loggingContext,(b=g(c.a.ReplyChainManagerGetReplyChains)).appendEventData({origin:t,correlationId:r,message:o?"requested_deeplink":"no_deeplink"}),w.label=1;case 1:return w.trys.push([1,3,4,5]),[4,l.getReplyChains(e,b,f)];case 2:return y=w.sent(),_=y.replyChains,O=y.telemetryData,j=Object(a.__rest)(y,["replyChains","telemetryData"]),S=Object(s.flatMap)(_,function(e){return e.messages;}),b.stop(),[2,Object(a.__assign)({messages:S,telemetryData:Zt(O)},j)];case 3:return C=w.sent(),v.error("getMessagesFromManager failed:  "+(C&&C.message),f,p.c.FailedToGet),b.fail({errors:C&&C.message}),[2,Promise.reject(C)];case 4:return Object(h.g)(i)||d.markConversationAsActive(i),[7];case 5:return[2];}});});},Xt=function Xt(e,t,n){return Object(a.__awaiter)(void 0,void 0,void 0,function(){var r,i,o,u,l,d,m,g,h,v,f,b;return Object(a.__generator)(this,function(y){switch(y.label){case 0:r=n.managers.replyChainManager,i=n.workerBootstrapServices,o=i.newScenario,u=i.logger,l=n.loggingContext,(d=o(c.a.ReplyChainManagerGetReplyChainsByKeys)).appendEventData({correlationId:e.correlationId,origin:t}),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,r.getReplyChainsByKeys(e,d,l)];case 2:return m=y.sent(),g=m.replyChains,h=m.telemetryData,v=Object(a.__rest)(m,["replyChains","telemetryData"]),f=Object(s.flatMap)(g,function(e){return e.messages;}),d.stop(),[2,Object(a.__assign)({messages:f,telemetryData:Zt(h)},v)];case 3:return b=y.sent(),u.error("getMessagesByKeysFromManager failed:  "+(b&&b.message),l,p.c.FailedToGet),d.fail({errors:b&&b.message}),[2,Promise.reject(b)];case 4:return[2];}});});},Yt=function Yt(e,t){return Object(s.map)(Object(s.orderBy)(e,function(e){return e.originalArrivalTime;},"desc"),function(e){return he(e.toIntermediateSchemaForServerConversion(t.currentUserMri),t.loggerFactory);});};function Zt(e){return{dataSource:$t(e.dataSource),isDBPrefetchRunning:e.isDBPrefetchRunning};}function $t(e){switch(e){case Kt.inMemory:return r.DataSource.inMemory;case Kt.indexedDB:return r.DataSource.indexedDB;case Kt.Network:return r.DataSource.network;default:return null;}}var en={Query:{graphqlStatus:function graphqlStatus(e,t,n){return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(e){return[2,Promise.resolve({status:"success"})];});});},conversations:function conversations(e,t,n){var r=n.managers,i=n.loggingContext;return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(e){switch(e.label){case 0:return[4,r.conversationManager.getConversations(void 0,i)];case 1:return[2,e.sent()];}});});},legacyMessages:function legacyMessages(e,t,n){var r=t.convId,i=t.count,o=t.cursor,c=t.deeplinkMessageId,u=t.correlationId,l=t.includeLatestData;return Object(a.__awaiter)(this,void 0,void 0,function(){var e;return Object(a.__generator)(this,function(t){switch(t.label){case 0:return[4,Qt({conversationId:r,count:i,token:o,deeplinkMessageId:c,correlationId:u,includeLatestData:l},Vt.MainRenderer,n)];case 1:return e=t.sent(),[2,{legacyMessages:Object(s.map)(e.messages,function(e){return e.toLegacySchema();}),cursor:e.token,deeplinkReplyChainId:e.deeplinkReplyChainId,isLatestDataPending:e.isLatestDataPending,errorCode:e.errorCode,telemetryData:e.telemetryData}];}});});},legacyMessagesByKeys:function legacyMessagesByKeys(e,t,n){var r=t.convId,i=t.keys,o=t.keyType,c=t.correlationId,u=t.includeLatestData;return Object(a.__awaiter)(this,void 0,void 0,function(){var e;return Object(a.__generator)(this,function(t){switch(t.label){case 0:return[4,Xt({conversationId:r,keys:i,keyType:o,correlationId:c,includeLatestData:u},Vt.MainRenderer,n)];case 1:return e=t.sent(),[2,{legacyMessages:Object(s.map)(e.messages,function(e){return e.toLegacySchema();}),telemetryData:e.telemetryData,isLatestDataPending:e.isLatestDataPending,errorCode:e.errorCode}];}});});}},Mutation:{putConversations:function putConversations(e,t,n){var r=t.conversations,i=n.managers,o=n.workerBootstrapServices,u=n.loggingContext;return Object(a.__awaiter)(this,void 0,Promise,function(){var e,t,n;return Object(a.__generator)(this,function(a){switch(a.label){case 0:if(e=o.newScenario(c.a.PutConversationsResolver),!r||!r.length)return e.fail({message:"conversations param not provided"}),[2,tn("PutConversations - conversations param not provided",u,o.logger)];t=Object(s.forEach)(r,function(e){e.source=b.a.ResolverPutConversation;}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,i.conversationManager.putConversations(t,b.a.ResolverPutConversation,e,u)];case 2:return a.sent(),e.stop(),[2,!0];case 3:return n=a.sent(),e.fail({message:n&&n.message}),[2,tn("PutConversations - errored out while putting conversations in the manager "+(n&&n.message),u,o.logger)];case 4:return[2];}});});},putLegacyMessages:function putLegacyMessages(e,t,n){var r=t.messages,i=t.correlationId,s=n.managers,o=n.workerBootstrapServices,u=n.loggingContext;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n;return Object(a.__generator)(this,function(a){switch(a.label){case 0:e=o.newScenario(c.a.PutLegacyMessagesResolver),i&&e.appendEventData({correlationId:i}),t=Bt.fromSkypeMessages(r,b.c.Local),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,s.replyChainManager.handleSyncedReplyChains(t,e,u,void 0)];case 2:return a.sent(),e.stop(),[2,!0];case 3:return n=a.sent(),e.fail({message:n&&n.message}),[2,tn("PutLegacyMessages - errored out while putting messages in the manager "+(n&&n.message),u,o.logger)];case 4:return[2];}});});},resolveEditClientLie:function resolveEditClientLie(e,t,n){var r=t.message,i=t.shouldResolve,s=t.correlationId,o=n.managers,u=n.workerBootstrapServices,l=n.loggingContext;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,n,d;return Object(a.__generator)(this,function(a){switch(a.label){case 0:e=Bt.fromSkypeMessages([r],b.c.Local)[0],t=u.newScenario(c.a.ResolveEditClientLieResolver),s&&t.appendEventData({correlationId:s}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,o.replyChainManager.resolveOrRevertEditClientLie(e,i,t,l)];case 2:return n=a.sent(),t.stop(),[2,n];case 3:return d=a.sent(),t.fail({message:d&&d.message}),[2,tn("resolveEditClientLie - errored out while trying to resolve client lie in the manager: "+(d&&d.message),l,u.logger)];case 4:return[2];}});});},removeConversations:function removeConversations(e,t,n){var r=t.conversationIds,i=n.managers,o=n.workerBootstrapServices,c=n.loggingContext;return Object(a.__awaiter)(this,void 0,Promise,function(){var e,t;return Object(a.__generator)(this,function(n){switch(n.label){case 0:if(!r||!r.length)return[2,tn("removeConversations - conversationIds param not provided",c,o.logger)];n.label=1;case 1:return n.trys.push([1,3,,4]),e=Object(s.map)(r,function(e){return function(e,t,n){return Object(a.__awaiter)(this,void 0,Promise,function(){var r,i;return Object(a.__generator)(this,function(a){if(!e)throw new TypeError("SyncUtilities - missing conversationId to delete");return r=new Ht([{name:"conversations",dependentOn:"syncstates"},{name:"syncstates"}]),i=Ht.convertObservableToPromise(r.observable,zt.MemoryCommitted),n.syncStateManager.deleteConversationSyncState(e,!1,r,t),n.conversationManager.removeConversations([e],r,t),[2,i];});});}(e,c,{conversationManager:i.conversationManager,syncStateManager:i.syncStateManager});}),[4,Promise.all(e)];case 2:return n.sent(),[2,!0];case 3:return[2,tn("RemoveConversations - errored out while removing conversations: "+((t=n.sent())&&t.message),c,o.logger)];case 4:return[2];}});});}},Subscription:{conversationUpdateEvent:{subscribe:function subscribe(e,t,n){var r=n.managers,i=n.workerBootstrapServices;return Object(a.__asyncGenerator)(this,arguments,function(){var e,t,n,s,o,c,u,d;return Object(a.__generator)(this,function(p){switch(p.label){case 0:e=new Ft(function(e){r.conversationManager.subscribe(function(t){e.next(t);});}),p.label=1;case 1:p.trys.push([1,8,9,14]),t=Object(a.__asyncValues)(l(e,1e3,i.newScenario,"conversationUpdateEvent")),p.label=2;case 2:return[4,Object(a.__await)(t.next())];case 3:return(n=p.sent()).done?[3,7]:(s=n.value,o={conversationUpdateEvent:s},[4,Object(a.__await)(o)]);case 4:return[4,p.sent()];case 5:p.sent(),p.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return c=p.sent(),u={error:c},[3,14];case 9:return p.trys.push([9,,12,13]),n&&!n.done&&(d=t.return)?[4,Object(a.__await)(d.call(t))]:[3,11];case 10:p.sent(),p.label=11;case 11:return[3,13];case 12:if(u)throw u.error;return[7];case 13:return[7];case 14:return[2];}});});}},legacyReplyChainUpdateEvent:{subscribe:function subscribe(e,t,n){var r=n.managers,i=n.workerBootstrapServices;return Object(a.__asyncGenerator)(this,arguments,function(){var e,t,n,s,o,c,u,d;return Object(a.__generator)(this,function(p){switch(p.label){case 0:e=new Ft(function(e){r.replyChainManager.subscribeToFilteredUpdates(function(t){e.next(t);});}),p.label=1;case 1:p.trys.push([1,8,9,14]),t=Object(a.__asyncValues)(l(e,1e3,i.newScenario,"legacyReplyChainUpdateEvent")),p.label=2;case 2:return[4,Object(a.__await)(t.next())];case 3:return(n=p.sent()).done?[3,7]:(s=n.value,o={legacyReplyChainUpdateEvent:{replyChain:s.replyChain.toLegacySchema(),updatedMessageIds:s.updatedMessageIds}},[4,Object(a.__await)(o)]);case 4:return[4,p.sent()];case 5:p.sent(),p.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return c=p.sent(),u={error:c},[3,14];case 9:return p.trys.push([9,,12,13]),n&&!n.done&&(d=t.return)?[4,Object(a.__await)(d.call(t))]:[3,11];case 10:p.sent(),p.label=11;case 11:return[3,13];case 12:if(u)throw u.error;return[7];case 13:return[7];case 14:return[2];}});});}},legacyChatServiceEvent:{subscribe:function subscribe(e,t,n){var r=n.longPollEventPublisher,i=n.workerBootstrapServices;return Object(a.__asyncGenerator)(this,arguments,function(){var e,t,n,s,o,c,u,d,p;return Object(a.__generator)(this,function(m){switch(m.label){case 0:e=new Ft(function(e){r.subscribe(e,function(e){return Jt(e);});}),t=l(e,1e3,i.newScenario,"legacyChatServiceEvent"),m.label=1;case 1:m.trys.push([1,8,9,14]),n=Object(a.__asyncValues)(t),m.label=2;case 2:return[4,Object(a.__await)(n.next())];case 3:return(s=m.sent()).done?[3,7]:(o=s.value,(c=Object(a.__assign)({},o)).resource=JSON.stringify(c.resource),[4,Object(a.__await)({legacyChatServiceEvent:c})]);case 4:return[4,m.sent()];case 5:m.sent(),m.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return u=m.sent(),d={error:u},[3,14];case 9:return m.trys.push([9,,12,13]),s&&!s.done&&(p=n.return)?[4,Object(a.__await)(p.call(n))]:[3,11];case 10:m.sent(),m.label=11;case 11:return[3,13];case 12:if(d)throw d.error;return[7];case 13:return[7];case 14:return[2];}});});}}}};function tn(e,t,n){return t.component="ChatLegacyResolvers",n.error(e,t,p.c.InvalidInput),Promise.reject(e);}var nn=n("CkJa"),rn={Query:{messages:function messages(e,t,n){var r=t.convId,i=t.cursor,o=t.replyChainId;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,t,c,u,l,p,m,g;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return e=n.loggingContext,t=n.coreSettings,c=e.requestRendererId+":"+e.requestId,o?(u={conversationId:r,keys:[o],keyType:Gt.ReplyChainId,includeLatestData:!0,correlationId:c},[4,Xt(u,Vt.Experience,n)]):[3,2];case 1:return an((l=a.sent()).errorCode),[2,{messages:Yt(l.messages,n),dataSource:l.telemetryData.dataSource}];case 2:return p={conversationId:r,token:i,count:t.get(d.a.Sync).chatReplyChainsToFetch||20,includeLatestData:!0,correlationId:c},[4,Qt(p,Vt.Experience,n)];case 3:return an((m=a.sent()).errorCode),g=Object(s.isNil)(m.token)?"1":m.token,[2,{messages:Yt(m.messages,n),cursor:g,dataSource:m.telemetryData.dataSource}];}});});}}};function an(e){if(!Object(s.isNil)(e))throw Object(w.a)("ChatWorkerResolvers",p.c.FailedToFetch,"messages",void 0,"Sync failed with "+e);}var sn=n("v0nE");function on(e,t,n,r,i,a,s,o){return{managers:{conversationManager:e,syncStateManager:t,replyChainManager:n},workerBootstrapServices:r,longPollEventPublisher:i,loggingContext:a,loggerFactory:new sn.a(),currentUserMri:s,coreSettings:o};}n.d(t,"resolvers",function(){return Ut;}),n.d(t,"IContext",function(){return Pt.IContext;}),n.d(t,"chatLegacyResolvers",function(){return en;}),n.d(t,"IWorkerContext",function(){return nn.IContext;}),n.d(t,"chatWorkerResolvers",function(){return rn;}),n.d(t,"chatWorkerContext",function(){return on;});}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/data-resolvers-chat-73b7f862b98565e2.js.map